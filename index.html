<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>TradeScope - Journal de Trading</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Manrope:wght@600;700;800&display=swap');
        
        :root {
            --bg-primary: #0A0E27;
            --bg-secondary: #111729;
            --bg-card: #1A1F3A;
            --sidebar-bg: #0D1226;
            --accent-primary: #6366F1;
            --accent-secondary: #8B5CF6;
            --accent-green: #10B981;
            --accent-red: #EF4444;
            --text-primary: #F1F5F9;
            --text-secondary: #94A3B8;
            --border: #1E293B;
            --shadow: rgba(99, 102, 241, 0.1);
        }

        [data-theme="light"] {
            --bg-primary: #F8FAFC;
            --bg-secondary: #FFFFFF;
            --bg-card: #FFFFFF;
            --sidebar-bg: #F1F5F9;
            --accent-primary: #6366F1;
            --accent-secondary: #8B5CF6;
            --accent-green: #10B981;
            --accent-red: #EF4444;
            --text-primary: #0F172A;
            --text-secondary: #64748B;
            --border: #E2E8F0;
            --shadow: rgba(99, 102, 241, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: var(--sidebar-bg);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            z-index: 100;
            transition: transform 0.3s ease;
        }

        .sidebar.mobile-hidden {
            transform: translateX(-100%);
        }

        .mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 99;
        }

        .mobile-overlay.active {
            display: block;
        }

        .mobile-menu-btn {
            display: none;
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-primary);
            width: 40px;
            height: 40px;
            border-radius: 8px;
            font-size: 1.5rem;
            cursor: pointer;
            align-items: center;
            justify-content: center;
        }

        .mobile-only {
            display: none;
        }

        .logo {
            padding: 1.5rem;
            font-size: 1.5rem;
            font-weight: 800;
            font-family: 'Manrope', sans-serif;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            border-bottom: 1px solid var(--border);
        }

        .sidebar-menu {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
        }

        .menu-section {
            margin-bottom: 1.5rem;
        }

        .menu-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
            margin-bottom: 0.5rem;
            padding: 0 0.75rem;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.95rem;
        }

        .menu-item:hover {
            background: var(--bg-card);
            color: var(--text-primary);
        }

        .menu-item.active {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            font-weight: 600;
        }

        .menu-icon {
            font-size: 1.2rem;
        }

        .account-selector {
            padding: 1rem;
            border-top: 1px solid var(--border);
        }

        .account-btn {
            width: 100%;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.75rem;
            color: var(--text-primary);
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s ease;
        }

        .account-btn:hover {
            border-color: var(--accent-primary);
        }

        /* Main Content */
        .main-content {
            margin-left: 260px;
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        .top-bar {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 700;
            font-family: 'Manrope', sans-serif;
        }

        .top-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .btn {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.95rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--shadow);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-primary);
        }

        .btn-outline:hover {
            border-color: var(--accent-primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
        }

        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .widget {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.2s ease;
        }

        .widget:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }

        .widget-1 { grid-column: span 3; }
        .widget-2 { grid-column: span 3; }
        .widget-3 { grid-column: span 3; }
        .widget-4 { grid-column: span 3; }
        .widget-calendar { grid-column: span 8; }
        .widget-sidebar { grid-column: span 4; }

        .widget-title {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .widget-value {
            font-size: 2rem;
            font-weight: 700;
            font-family: 'Manrope', sans-serif;
            margin-bottom: 0.5rem;
        }

        .widget-change {
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .widget-change.positive { color: var(--accent-green); }
        .widget-change.negative { color: var(--accent-red); }

        /* Calendar */
        .calendar {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .calendar-title {
            font-size: 1.25rem;
            font-weight: 700;
            font-family: 'Manrope', sans-serif;
        }

        .calendar-nav {
            display: flex;
            gap: 0.5rem;
        }

        .calendar-nav button {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            width: 36px;
            height: 36px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.2s ease;
        }

        .calendar-nav button:hover {
            border-color: var(--accent-primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
        }

        .calendar-day-header {
            text-align: center;
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-weight: 600;
            padding: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .calendar-day {
            aspect-ratio: 1;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .calendar-day:hover {
            border-color: var(--accent-primary);
            transform: scale(1.05);
        }

        .calendar-day.today {
            border: 2px solid var(--accent-primary);
        }

        .calendar-day.has-trades {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
        }

        .calendar-day.profit {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(34, 197, 94, 0.1));
            border-color: var(--accent-green);
        }

        .calendar-day.loss {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(248, 113, 113, 0.1));
            border-color: var(--accent-red);
        }

        .calendar-day-number {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .calendar-day.has-trades .calendar-day-number {
            color: var(--text-primary);
        }

        .calendar-day-pnl {
            font-size: 0.75rem;
            font-weight: 700;
            text-align: center;
            margin-top: 0.25rem;
        }

        .calendar-day-trades {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-align: center;
        }

        /* Weekly Summary Sidebar */
        .weekly-summary {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .week-item {
            padding: 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .week-item:hover {
            border-color: var(--accent-primary);
        }

        .week-item.active {
            border-color: var(--accent-primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .week-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .week-pnl {
            font-size: 1.5rem;
            font-weight: 700;
            font-family: 'Manrope', sans-serif;
            margin-bottom: 0.25rem;
        }

        .week-stats {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* Trades List */
        .trades-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
        }

        .trades-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .filter-pills {
            display: flex;
            gap: 0.5rem;
        }

        .filter-pill {
            padding: 0.5rem 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-secondary);
        }

        .filter-pill:hover {
            border-color: var(--accent-primary);
            color: var(--text-primary);
        }

        .filter-pill.active {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            border-color: transparent;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: var(--bg-secondary);
        }

        th {
            padding: 1rem 1.5rem;
            text-align: left;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            font-weight: 700;
            border-bottom: 1px solid var(--border);
        }

        td {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border);
            font-size: 0.95rem;
        }

        tbody tr {
            transition: background 0.15s ease;
        }

        tbody tr:hover {
            background: var(--bg-secondary);
        }

        .trade-type-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;

        /* Trade Cards for Mobile */
        .trade-card {
            display: none; /* Hidden by default, shown on mobile */
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }

        .trade-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border);
        }

        .trade-card-body {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            font-size: 0.9rem;
        }

        .trade-card-field {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .trade-card-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .trade-card-value {
            font-weight: 600;
        }

        .trade-card-actions {
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 0.5rem;
        }
            text-transform: uppercase;
        }

        .trade-type-badge.long {
            background: rgba(16, 185, 129, 0.2);
            color: var(--accent-green);
        }

        .trade-type-badge.short {
            background: rgba(239, 68, 68, 0.2);
            color: var(--accent-red);
        }

        .pnl-value {
            font-weight: 700;
            font-family: 'Manrope', sans-serif;
        }

        .pnl-value.positive { color: var(--accent-green); }
        .pnl-value.negative { color: var(--accent-red); }

        /* Trade Form Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            font-family: 'Manrope', sans-serif;
        }

        .modal-close {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: span 2;
        }

        label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-weight: 600;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        input, select, textarea {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            transition: all 0.2s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 8px;
            margin: 1rem 0;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-group label {
            margin: 0;
            cursor: pointer;
            text-transform: none;
            letter-spacing: normal;
        }

        /* Stats View */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .stat-card-title {
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
            margin-bottom: 1.5rem;
        }

        .comparison-boxes {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .comparison-box {
            padding: 1.5rem;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 10px;
            text-align: center;
        }

        .comparison-box.long {
            border-color: var(--accent-green);
        }

        .comparison-box.short {
            border-color: var(--accent-red);
        }

        .comparison-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
            font-weight: 600;
        }

        .comparison-value {
            font-size: 1.75rem;
            font-weight: 700;
            font-family: 'Manrope', sans-serif;
            margin-bottom: 0.5rem;
        }

        .comparison-stats {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .day-performance {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .day-row {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .day-name {
            min-width: 80px;
            font-weight: 600;
        }

        .day-bar-container {
            flex: 1;
            height: 10px;
            background: var(--bg-secondary);
            border-radius: 5px;
            overflow: hidden;
        }

        .day-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 5px;
            transition: width 0.5s ease;
        }

        .day-value {
            min-width: 100px;
            text-align: right;
            font-weight: 700;
            font-family: 'Manrope', sans-serif;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        /* Account Modal */
        .account-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .account-item {
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 10px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .account-item:hover {
            border-color: var(--accent-primary);
        }

        .account-item.active {
            border-color: var(--accent-primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .account-info h4 {
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
        }

        .account-info p {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .account-value {
            font-size: 1.5rem;
            font-weight: 700;
            font-family: 'Manrope', sans-serif;
        }

        @media (max-width: 1400px) {
            .dashboard-grid {
                grid-template-columns: repeat(12, 1fr);
            }
        }

        @media (max-width: 1200px) {
            .widget-1, .widget-2, .widget-3, .widget-4 {
                grid-column: span 6;
            }
            .widget-calendar {
                grid-column: span 12;
            }
            .widget-sidebar {
                grid-column: span 12;
            }

            .comparison-boxes {
                gap: 0.75rem;
            }
        }

        @media (max-width: 992px) {
            .sidebar {
                width: 260px;
            }

            .widget-1, .widget-2, .widget-3, .widget-4 {
                grid-column: span 6;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            th, td {
                padding: 0.875rem 1rem;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 768px) {
            .desktop-text {
                display: none;
            }

            .mobile-text {
                display: inline !important;
            }

            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.mobile-open {
                transform: translateX(0);
                box-shadow: 4px 0 20px rgba(0, 0, 0, 0.5);
            }

            .main-content {
                margin-left: 0;
                width: 100%;
            }

            .mobile-menu-btn {
                display: flex;
            }

            .mobile-only {
                display: flex !important;
            }

            .account-selector {
                display: none;
            }

            .top-bar {
                padding: 1rem;
                flex-wrap: wrap;
                gap: 0.75rem;
            }

            .page-title {
                font-size: 1.25rem;
            }

            .top-actions {
                gap: 0.5rem;
                flex-wrap: wrap;
            }

            #googleUserBadge {
                display: none !important;
            }

            #googleSignInBtn .desktop-text {
                display: none;
            }

            #googleSignInBtn {
                padding: 0.65rem !important;
                min-width: auto !important;
            }

            /* Show connected indicator on mobile when signed in */
            #googleSignInBtn.connected::after {
                content: '';
                position: absolute;
                top: 4px;
                right: 4px;
                width: 8px;
                height: 8px;
                background: var(--accent-green);
                border-radius: 50%;
                border: 2px solid var(--bg-secondary);
            }

            .btn {
                padding: 0.65rem 1.25rem;
                font-size: 0.9rem;
                white-space: nowrap;
            }

            .content-area {
                padding: 1rem;
            }

            .dashboard-grid {
                gap: 1rem;
            }

            .widget-1, .widget-2, .widget-3, .widget-4 {
                grid-column: span 12;
            }

            .widget {
                padding: 1.25rem;
            }

            .widget-value {
                font-size: 1.75rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
                gap: 0.875rem;
            }

            .form-group.full-width {
                grid-column: span 1;
            }

            .trades-container {
                overflow-x: visible;
            }

            .trades-header {
                padding: 1rem;
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .filter-pills {
                overflow-x: auto;
                flex-wrap: nowrap;
                width: 100%;
                padding-bottom: 0.5rem;
            }

            .filter-pill {
                white-space: nowrap;
                flex-shrink: 0;
            }

            /* Hide tables on mobile, show cards */
            table {
                display: none;
            }

            .trade-card {
                display: block;
            }

            .trades-container .empty-state {
                display: flex;
            }

            th, td {
                padding: 0.75rem 0.5rem;
            }

            .trade-type-badge {
                font-size: 0.7rem;
                padding: 0.2rem 0.6rem;
            }

            .modal-content {
                width: 95%;
                max-width: 95vw;
                padding: 1.5rem;
                max-height: 85vh;
            }

            .modal-header {
                margin-bottom: 1.5rem;
            }

            .modal-title {
                font-size: 1.25rem;
            }

            .account-list {
                gap: 0.5rem;
            }

            .account-item {
                padding: 0.875rem;
                flex-direction: column;
                align-items: flex-start;
                gap: 0.75rem;
            }

            .account-value {
                font-size: 1.35rem;
                align-self: flex-end;
            }

            /* Day trades modal responsive */
            #dayTradesModal .modal-content {
                max-width: 95vw;
                padding: 1rem;
            }

            #dayTradesModal table {
                font-size: 0.85rem;
            }

            #dayTradesModal th, #dayTradesModal td {
                padding: 0.5rem !important;
            }

            /* Account buttons on mobile */
            .account-item button {
                font-size: 0.7rem !important;
                padding: 0.2rem 0.5rem !important;
            }
        }

        @media (max-width: 480px) {
            .logo {
                font-size: 1.25rem;
                padding: 1.25rem;
            }

            .page-title {
                font-size: 1.1rem;
            }

            .btn {
                padding: 0.6rem 1rem;
                font-size: 0.85rem;
            }

            .widget-value {
                font-size: 1.5rem;
            }

            .widget-title {
                font-size: 0.75rem;
            }

            .calendar-day {
                min-height: 50px;
                padding: 0.25rem;
            }

            .calendar-day-number {
                font-size: 0.75rem;
            }

            .calendar-day-pnl {
                font-size: 0.65rem;
            }

            .calendar-day-trades {
                font-size: 0.6rem;
                display: none;
            }

            .week-pnl {
                font-size: 1.25rem;
            }

            .comparison-value {
                font-size: 1.35rem;
            }

            table {
                font-size: 0.8rem;
            }

            th, td {
                padding: 0.65rem 0.4rem;
            }

            .modal-content {
                padding: 1.25rem;
            }

            .form-grid {
                gap: 0.75rem;
            }

            input, select, textarea {
                padding: 0.65rem 0.875rem;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 360px) {
            .content-area {
                padding: 0.75rem;
            }

            .widget {
                padding: 1rem;
            }

            .calendar {
                padding: 0.75rem;
            }

            .calendar-grid {
                gap: 0.25rem;
            }

            .calendar-day {
                min-height: 45px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Mobile Overlay -->
        <div class="mobile-overlay" id="mobileOverlay" onclick="journal.closeMobileMenu()"></div>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="logo">‚ö° TRADESCOPE</div>
            
            <nav class="sidebar-menu">
                <div class="menu-section">
                    <div class="menu-label">Principal</div>
                    <div class="menu-item active" data-view="dashboard">
                        <span class="menu-icon">üìä</span>
                        <span>Dashboard</span>
                    </div>
                    <div class="menu-item" data-view="trades">
                        <span class="menu-icon">üíº</span>
                        <span>Trades</span>
                    </div>
                    <div class="menu-item" data-view="payouts">
                        <span class="menu-icon">üí∞</span>
                        <span>Payouts</span>
                    </div>
                    <div class="menu-item" data-view="statistics">
                        <span class="menu-icon">üìà</span>
                        <span>Stats Compte</span>
                    </div>
                    <div class="menu-item" data-view="globalStats">
                        <span class="menu-icon">üåç</span>
                        <span>Stats Globales</span>
                    </div>
                </div>

                <div class="menu-section">
                    <div class="menu-label">Outils</div>
                    <div class="menu-item mobile-only" onclick="journal.openAccountModal()">
                        <span class="menu-icon">üë§</span>
                        <span>Changer de Compte</span>
                    </div>
                    <div class="menu-item" data-view="journal">
                        <span class="menu-icon">üìù</span>
                        <span>Journal</span>
                    </div>
                    <div class="menu-item" data-view="playbook">
                        <span class="menu-icon">üìö</span>
                        <span>Playbook</span>
                    </div>
                </div>
            </nav>

            <div class="account-selector">
                <button class="account-btn" onclick="journal.openAccountModal()">
                    <span id="currentAccountDisplay">Compte Principal</span>
                    <span>‚ñº</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <button class="mobile-menu-btn" onclick="journal.toggleMobileMenu()">‚ò∞</button>
                    <h1 class="page-title" id="pageTitle">Dashboard</h1>
                </div>
                <div class="top-actions">
                    <button class="btn btn-outline" onclick="journal.toggleTheme()" style="padding: 0.75rem; min-width: auto;" title="Changer de th√®me">
                        <span id="themeIcon">üåô</span>
                    </button>
                    <button class="btn btn-outline" id="googleSignInBtn" onclick="journal.signInWithGoogle()" style="display: flex; align-items: center; gap: 0.5rem;">
                        <span>‚òÅÔ∏è</span>
                        <span class="desktop-text">Se connecter</span>
                    </button>
                    <div id="googleUserBadge" style="display: none; align-items: center; gap: 0.75rem; padding: 0.5rem 1rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px;">
                        <img id="googleUserAvatarTop" style="width: 32px; height: 32px; border-radius: 50%;" src="" alt="">
                        <div style="display: flex; flex-direction: column; min-width: 0;">
                            <span style="font-size: 0.85rem; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" id="googleUserNameTop"></span>
                            <span style="font-size: 0.7rem; color: var(--text-secondary);">Connect√©</span>
                        </div>
                        <button onclick="journal.signOutFromTop()" style="background: transparent; border: 1px solid var(--border); color: var(--text-secondary); padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.8rem;" title="D√©connexion">√ó</button>
                    </div>
                    <button class="btn" onclick="journal.openTradeModal()">
                        <span class="desktop-text">+ Nouveau Trade</span>
                        <span class="mobile-text" style="display: none;">+ Trade</span>
                    </button>
                </div>
            </div>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Dashboard View -->
                <div id="dashboard" class="view active">
                    <!-- Widgets -->
                    <div class="dashboard-grid">
                        <div class="widget widget-1">
                            <div class="widget-title">Capital Actuel</div>
                            <div class="widget-value" id="widgetCapital">50 000‚Ç¨</div>
                            <div class="widget-change positive" id="widgetCapitalChange">
                                <span>‚ñ≤</span>
                                <span>+0%</span>
                            </div>
                        </div>

                        <div class="widget widget-2">
                            <div class="widget-title">P&L Total</div>
                            <div class="widget-value" id="widgetPnL">0‚Ç¨</div>
                            <div class="widget-change" id="widgetPnLChange">
                                <span>‚óè</span>
                                <span>0 trades</span>
                            </div>
                        </div>

                        <div class="widget widget-3">
                            <div class="widget-title">Win Rate</div>
                            <div class="widget-value" id="widgetWinRate">0%</div>
                            <div class="widget-change" id="widgetWinRateChange">
                                <span>‚óã</span>
                                <span>0W / 0L</span>
                            </div>
                        </div>

                        <div class="widget widget-4">
                            <div class="widget-title">P&L Mensuel</div>
                            <div class="widget-value" id="widgetMonthlyPnL">0‚Ç¨</div>
                            <div class="widget-change" id="widgetMonthlyProgress">
                                <span>‚óê</span>
                                <span>0%</span>
                            </div>
                        </div>

                        <!-- Calendar -->
                        <div class="widget-calendar">
                            <div class="calendar">
                                <div class="calendar-header">
                                    <h2 class="calendar-title" id="calendarMonth">Janvier 2025</h2>
                                    <div class="calendar-nav">
                                        <button onclick="journal.previousMonth()">‚óÄ</button>
                                        <button onclick="journal.nextMonth()">‚ñ∂</button>
                                    </div>
                                </div>
                                <div class="calendar-grid" id="calendarGrid">
                                    <!-- Generated by JS -->
                                </div>
                            </div>
                        </div>

                        <!-- Weekly Sidebar -->
                        <div class="widget-sidebar">
                            <div class="weekly-summary">
                                <div class="widget-title">Semaines</div>
                                <div id="weeksSummary">
                                    <!-- Generated by JS -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Trades View -->
                <div id="trades" class="view">
                    <div class="trades-container">
                        <div class="trades-header">
                            <h2 class="calendar-title">Historique des Trades</h2>
                            <div class="filter-pills">
                                <button class="filter-pill active" data-filter="all">Tous</button>
                                <button class="filter-pill" data-filter="month">Ce Mois</button>
                                <button class="filter-pill" data-filter="week">Semaine</button>
                                <button class="filter-pill" data-filter="wins">Gains</button>
                                <button class="filter-pill" data-filter="losses">Pertes</button>
                            </div>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Instrument</th>
                                    <th>Type</th>
                                    <th>Taille</th>
                                    <th>P&L</th>
                                    <th>% Capital</th>
                                    <th>Strat√©gie</th>
                                    <th>Chart</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="tradesTableBody">
                                <tr>
                                    <td colspan="9" class="empty-state">
                                        <div class="empty-icon">üìä</div>
                                        <div>Aucun trade enregistr√©</div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <!-- Mobile Cards Container -->
                        <div id="tradesCardsContainer" style="padding: 1rem;">
                            <!-- Generated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Payouts View -->
                <div id="payouts" class="view">
                    <div style="margin-bottom: 2rem;">
                        <h2 class="calendar-title" style="margin-bottom: 0.5rem;">Historique des Payouts</h2>
                        <p style="color: var(--text-secondary); font-size: 0.95rem;">Retraits effectu√©s - n'impactent pas les statistiques de trading</p>
                    </div>

                    <!-- Summary Cards -->
                    <div class="dashboard-grid" style="margin-bottom: 2rem;">
                        <div class="widget widget-1">
                            <div class="widget-title">Total Payouts (Compte)</div>
                            <div class="widget-value" id="payoutAccountTotal" style="color: var(--accent-red);">0‚Ç¨</div>
                            <div class="widget-change" id="payoutAccountCount">
                                <span>‚óè</span>
                                <span>0 payouts</span>
                            </div>
                        </div>

                        <div class="widget widget-2">
                            <div class="widget-title">Total Payouts (Global)</div>
                            <div class="widget-value" id="payoutGlobalTotal" style="color: var(--accent-red);">0‚Ç¨</div>
                            <div class="widget-change" id="payoutGlobalCount">
                                <span>‚óè</span>
                                <span>0 payouts</span>
                            </div>
                        </div>

                        <div class="widget widget-3">
                            <div class="widget-title">Dernier Payout</div>
                            <div class="widget-value" id="payoutLast" style="font-size: 1.3rem;">-</div>
                            <div class="widget-change" id="payoutLastDate">
                                <span>‚óã</span>
                                <span>-</span>
                            </div>
                        </div>

                        <div class="widget widget-4">
                            <div class="widget-title">Moyenne par Payout</div>
                            <div class="widget-value" id="payoutAverage">0‚Ç¨</div>
                            <div class="widget-change">
                                <span>‚óê</span>
                                <span>Moyenne</span>
                            </div>
                        </div>
                    </div>

                    <!-- Payouts Table -->
                    <div class="trades-container">
                        <div class="trades-header">
                            <h2 class="calendar-title">Liste des Payouts</h2>
                            <div class="filter-pills">
                                <button class="filter-pill active" data-filter-payout="all">Tous</button>
                                <button class="filter-pill" data-filter-payout="month">Ce Mois</button>
                                <button class="filter-pill" data-filter-payout="year">Cette Ann√©e</button>
                            </div>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Compte</th>
                                    <th>Montant</th>
                                    <th>Capital Avant</th>
                                    <th>Capital Apr√®s</th>
                                    <th>Notes</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="payoutsTableBody">
                                <tr>
                                    <td colspan="7" class="empty-state">
                                        <div class="empty-icon">üí∞</div>
                                        <div>Aucun payout enregistr√©</div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <!-- Mobile Cards Container -->
                        <div id="payoutsCardsContainer" style="padding: 1rem;">
                            <!-- Generated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Statistics View -->
                <div id="statistics" class="view">
                    <h2 class="calendar-title" style="margin-bottom: 1.5rem;">Statistiques - <span id="statsAccountName"></span></h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-card-title">Performance par Jour</div>
                            <div class="day-performance" id="dayPerformance">
                                <!-- Generated by JS -->
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-card-title">Long vs Short</div>
                            <div class="comparison-boxes">
                                <div class="comparison-box long">
                                    <div class="comparison-label">LONG</div>
                                    <div class="comparison-value" id="statsLongPnL">0‚Ç¨</div>
                                    <div class="comparison-stats" id="statsLongInfo">0 trades | 0% WR</div>
                                </div>
                                <div class="comparison-box short">
                                    <div class="comparison-label">SHORT</div>
                                    <div class="comparison-value" id="statsShortPnL">0‚Ç¨</div>
                                    <div class="comparison-stats" id="statsShortInfo">0 trades | 0% WR</div>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-card-title">Respect de la Strat√©gie</div>
                            <div style="text-align: center;">
                                <div style="font-size: 3rem; font-weight: 700; font-family: 'Manrope', sans-serif; margin-bottom: 0.5rem;" id="statsStrategyPercent">0%</div>
                                <div style="color: var(--text-secondary); margin-bottom: 1.5rem;" id="statsStrategyDetails">0 / 0 trades</div>
                                <div style="padding-top: 1.5rem; border-top: 1px solid var(--border);">
                                    <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Avec strat√©gie:</div>
                                    <div id="statsWithStrategy" style="font-weight: 700; margin-bottom: 1rem;">-</div>
                                    <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Sans strat√©gie:</div>
                                    <div id="statsWithoutStrategy" style="font-weight: 700;">-</div>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-card-title">Meilleurs Instruments</div>
                            <div id="statsBestInstruments" style="display: flex; flex-direction: column; gap: 0.75rem;">
                                <!-- Generated by JS -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Global Stats View -->
                <div id="globalStats" class="view">
                    <h2 class="calendar-title" style="margin-bottom: 1.5rem;">Statistiques Globales - Tous Comptes</h2>
                    
                    <!-- Global Summary -->
                    <div class="dashboard-grid" style="margin-bottom: 2rem;">
                        <div class="widget widget-1">
                            <div class="widget-title">Capital Total</div>
                            <div class="widget-value" id="globalCapitalWidget">0‚Ç¨</div>
                            <div class="widget-change" id="globalAccountsCount">
                                <span>‚óè</span>
                                <span>0 comptes</span>
                            </div>
                        </div>

                        <div class="widget widget-2">
                            <div class="widget-title">P&L Total</div>
                            <div class="widget-value" id="globalPnLWidget">0‚Ç¨</div>
                            <div class="widget-change" id="globalTradesCount">
                                <span>‚óè</span>
                                <span>0 trades</span>
                            </div>
                        </div>

                        <div class="widget widget-3">
                            <div class="widget-title">Win Rate Global</div>
                            <div class="widget-value" id="globalWinRateWidget">0%</div>
                            <div class="widget-change" id="globalWinRateDetails">
                                <span>‚óã</span>
                                <span>0W / 0L</span>
                            </div>
                        </div>

                        <div class="widget widget-4">
                            <div class="widget-title">Meilleur Compte</div>
                            <div class="widget-value" id="globalBestAccount" style="font-size: 1.3rem;">-</div>
                            <div class="widget-change positive" id="globalBestAccountPnL">
                                <span>‚ñ≤</span>
                                <span>0‚Ç¨</span>
                            </div>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-card-title">Performance par Jour (Global)</div>
                            <div class="day-performance" id="globalDayPerformance">
                                <!-- Generated by JS -->
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-card-title">Long vs Short (Global)</div>
                            <div class="comparison-boxes">
                                <div class="comparison-box long">
                                    <div class="comparison-label">LONG</div>
                                    <div class="comparison-value" id="globalLongPnL">0‚Ç¨</div>
                                    <div class="comparison-stats" id="globalLongInfo">0 trades | 0% WR</div>
                                </div>
                                <div class="comparison-box short">
                                    <div class="comparison-label">SHORT</div>
                                    <div class="comparison-value" id="globalShortPnL">0‚Ç¨</div>
                                    <div class="comparison-stats" id="globalShortInfo">0 trades | 0% WR</div>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-card-title">Respect de la Strat√©gie (Global)</div>
                            <div style="text-align: center;">
                                <div style="font-size: 3rem; font-weight: 700; font-family: 'Manrope', sans-serif; margin-bottom: 0.5rem;" id="globalStrategyPercent">0%</div>
                                <div style="color: var(--text-secondary); margin-bottom: 1.5rem;" id="globalStrategyDetails">0 / 0 trades</div>
                                <div style="padding-top: 1.5rem; border-top: 1px solid var(--border);">
                                    <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Avec strat√©gie:</div>
                                    <div id="globalWithStrategy" style="font-weight: 700; margin-bottom: 1rem;">-</div>
                                    <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Sans strat√©gie:</div>
                                    <div id="globalWithoutStrategy" style="font-weight: 700;">-</div>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-card-title">Meilleurs Instruments (Global)</div>
                            <div id="globalBestInstruments" style="display: flex; flex-direction: column; gap: 0.75rem;">
                                <!-- Generated by JS -->
                            </div>
                        </div>
                    </div>

                    <!-- Accounts Comparison -->
                    <div style="margin-top: 2rem;">
                        <h2 class="calendar-title" style="margin-bottom: 1.5rem;">Comparaison des Comptes</h2>
                        <div id="accountsComparison" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 1.5rem;">
                            <!-- Generated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Journal View (placeholder) -->
                <div id="journal" class="view">
                    <div class="empty-state">
                        <div class="empty-icon">üìù</div>
                        <h3>Journal de Trading</h3>
                        <p>Fonctionnalit√© √† venir...</p>
                    </div>
                </div>

                <!-- Playbook View -->
                <div id="playbook" class="view">
                    <div style="max-width: 900px; margin: 0 auto;">
                        <div style="margin-bottom: 2rem;">
                            <h2 class="calendar-title" style="margin-bottom: 0.5rem;">üìö Mon Playbook</h2>
                            <p style="color: var(--text-secondary); font-size: 0.95rem;">
                                Ta checklist personnalis√©e avant chaque trade. Respecte-la pour rester disciplin√© !
                            </p>
                        </div>

                        <!-- Stats Cards -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                            <div class="widget">
                                <div class="widget-title">Respect Aujourd'hui</div>
                                <div class="widget-value" id="playbookTodayPercent" style="color: var(--accent-primary);">0%</div>
                                <div class="widget-change" id="playbookTodayCount">
                                    <span>‚óè</span>
                                    <span>0 / 0 trades</span>
                                </div>
                            </div>

                            <div class="widget">
                                <div class="widget-title">Respect Global</div>
                                <div class="widget-value" id="playbookGlobalPercent">0%</div>
                                <div class="widget-change" id="playbookGlobalCount">
                                    <span>‚óè</span>
                                    <span>0 / 0 trades</span>
                                </div>
                            </div>

                            <div class="widget">
                                <div class="widget-title">Win Rate (Suivi)</div>
                                <div class="widget-value" id="playbookWinRate" style="color: var(--accent-green);">0%</div>
                                <div class="widget-change">
                                    <span>‚úì</span>
                                    <span>Avec strat√©gie</span>
                                </div>
                            </div>
                        </div>

                        <!-- Daily Checklist -->
                        <div class="stat-card" style="margin-bottom: 2rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                                <div class="stat-card-title">‚úÖ Checklist du Jour</div>
                                <button class="btn btn-outline" onclick="journal.resetDailyChecklist()" style="padding: 0.5rem 1rem; font-size: 0.85rem;">
                                    üîÑ Reset
                                </button>
                            </div>
                            <div id="dailyChecklistContainer">
                                <!-- Generated by JS -->
                            </div>
                        </div>

                        <!-- Playbook Rules Management -->
                        <div class="stat-card">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                                <div class="stat-card-title">üìã Mes R√®gles de Trading</div>
                                <button class="btn" onclick="journal.openAddRuleModal()" style="padding: 0.5rem 1rem; font-size: 0.85rem;">
                                    + Ajouter
                                </button>
                            </div>
                            <div id="playbookRulesList" style="display: flex; flex-direction: column; gap: 0.75rem;">
                                <!-- Generated by JS -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Trade Modal -->
    <div id="tradeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Nouveau Trade</h2>
                <button class="modal-close" onclick="journal.closeTradeModal()">√ó</button>
            </div>
            <form id="tradeForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="tradeDate">Date</label>
                        <input type="date" id="tradeDate" required>
                    </div>
                    <div class="form-group">
                        <label for="instrument">Instrument</label>
                        <select id="instrument">
                            <option value="">S√©lectionner...</option>
                            <optgroup label="Indices US">
                                <option value="NASDAQ/MNQ">NASDAQ / MNQ</option>
                                <option value="SP500/MES">SP500 / MES</option>
                                <option value="DOWJONES/MYM">DOWJONES / MYM</option>
                            </optgroup>
                            <optgroup label="Forex Majeurs">
                                <option value="EUR/USD">EUR/USD</option>
                                <option value="GBP/USD">GBP/USD</option>
                                <option value="USD/JPY">USD/JPY</option>
                                <option value="USD/CHF">USD/CHF</option>
                                <option value="AUD/USD">AUD/USD</option>
                                <option value="NZD/USD">NZD/USD</option>
                                <option value="USD/CAD">USD/CAD</option>
                            </optgroup>
                            <optgroup label="Forex Mineurs">
                                <option value="EUR/GBP">EUR/GBP</option>
                                <option value="EUR/JPY">EUR/JPY</option>
                                <option value="GBP/JPY">GBP/JPY</option>
                                <option value="EUR/AUD">EUR/AUD</option>
                                <option value="EUR/CAD">EUR/CAD</option>
                                <option value="GBP/AUD">GBP/AUD</option>
                            </optgroup>
                            <optgroup label="Crypto">
                                <option value="BTC/USD">BTC/USD</option>
                                <option value="ETH/USD">ETH/USD</option>
                                <option value="SOL/USD">SOL/USD</option>
                                <option value="XRP/USD">XRP/USD</option>
                            </optgroup>
                            <optgroup label="Mati√®res Premi√®res">
                                <option value="GOLD/XAU">GOLD / XAU</option>
                                <option value="SILVER/XAG">SILVER / XAG</option>
                                <option value="OIL/WTI">OIL / WTI</option>
                                <option value="OIL/BRENT">OIL / BRENT</option>
                            </optgroup>
                            <option value="AUTRE">Autre (personnalis√©)</option>
                        </select>
                    </div>
                    <div class="form-group" id="customInstrumentGroup" style="display: none;">
                        <label for="customInstrument">Instrument personnalis√©</label>
                        <input type="text" id="customInstrument" placeholder="Ex: EUR/GBP">
                    </div>
                    <div class="form-group">
                        <label for="tradeType">Type</label>
                        <select id="tradeType">
                            <option value="LONG">LONG</option>
                            <option value="SHORT">SHORT</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="pnl">P&L (‚Ç¨)</label>
                        <input type="number" id="pnl" step="0.01" placeholder="125.50" required>
                    </div>
                    <div class="form-group">
                        <label for="positionSize">Taille (lots)</label>
                        <input type="number" id="positionSize" step="0.01" placeholder="1.00">
                    </div>
                    <div class="form-group">
                        <label for="tradingViewLink">Lien TradingView</label>
                        <input type="url" id="tradingViewLink" placeholder="https://...">
                    </div>
                    <div class="form-group full-width">
                        <label for="notes">Notes</label>
                        <textarea id="notes" placeholder="Setup, √©motions, observations..."></textarea>
                    </div>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="followedStrategy">
                    <label for="followedStrategy">J'ai suivi ma strat√©gie</label>
                </div>
                <div class="checkbox-group" style="background: rgba(239, 68, 68, 0.1); border: 1px solid var(--accent-red);">
                    <input type="checkbox" id="isPayout" onchange="journal.togglePayoutMode(this.checked)">
                    <label for="isPayout">üí∞ Payout (retrait - ne compte pas dans les stats)</label>
                </div>
                <button type="submit" class="btn" style="width: 100%;">Ajouter le Trade</button>
            </form>
        </div>
    </div>

    <!-- Account Modal -->
    <div id="accountModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Mes Comptes</h2>
                <button class="modal-close" onclick="journal.closeAccountModal()">√ó</button>
            </div>
            <div class="account-list" id="accountList">
                <!-- Generated by JS -->
            </div>
            <button class="btn btn-outline" onclick="journal.showAddAccountForm()" style="width: 100%;">+ Nouveau Compte</button>
            
            <div id="addAccountForm" style="display: none; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border);">
                <form id="accountForm">
                    <div class="form-group" style="margin-bottom: 1rem;">
                        <label for="accountName">Nom du Compte</label>
                        <input type="text" id="accountName" placeholder="Compte Principal" required>
                    </div>
                    <div class="form-group" style="margin-bottom: 1rem;">
                        <label for="propFirm">Prop Firm / Broker</label>
                        <input type="text" id="propFirm" placeholder="FTMO, MyForexFunds..." required>
                    </div>
                    <div class="form-group" style="margin-bottom: 1.5rem;">
                        <label for="accountCapital">Capital (‚Ç¨)</label>
                        <input type="number" id="accountCapital" placeholder="50000" required>
                    </div>
                    <div style="display: flex; gap: 1rem;">
                        <button type="submit" class="btn" style="flex: 1;">Cr√©er</button>
                        <button type="button" class="btn btn-outline" onclick="journal.hideAddAccountForm()" style="flex: 1;">Annuler</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Day Trades Modal -->
    <div id="dayTradesModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <h2 id="dayTradesTitle" style="margin-bottom: 1.5rem;">Trades du jour</h2>
            <div id="dayTradesContainer">
                <!-- Trades list will be inserted here -->
            </div>
            <button class="btn btn-outline" onclick="journal.closeDayTradesModal()" style="width: 100%; margin-top: 1rem;">Fermer</button>
        </div>
    </div>

    <!-- Add Rule Modal -->
    <div id="addRuleModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <h2 style="margin-bottom: 1.5rem;">‚ûï Ajouter une r√®gle</h2>
            <form id="addRuleForm" onsubmit="journal.addPlaybookRule(event)">
                <div class="form-group" style="margin-bottom: 1.5rem;">
                    <label for="ruleText">R√®gle</label>
                    <input type="text" id="ruleText" placeholder="Ex: V√©rifier la tendance H4" required style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-card); color: var(--text-primary);">
                </div>
                <div style="display: flex; gap: 1rem;">
                    <button type="submit" class="btn" style="flex: 1;">Ajouter</button>
                    <button type="button" class="btn btn-outline" onclick="journal.closeAddRuleModal()" style="flex: 1;">Annuler</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        class TradingJournal {
            constructor() {
                this.accessToken = null;
                this.googleUser = null;
                this.driveFileId = null;
                this.currentTheme = localStorage.getItem('theme') || 'dark';
                this.currentView = 'dashboard';
                this.currentMonth = new Date();
                this.currentFilter = 'all';
                this.settings = this.loadSettings();
                this.accounts = this.loadAccounts();
                this.currentAccountId = this.loadCurrentAccountId();
                this.trades = this.loadTrades();
                this.playbookRules = this.loadPlaybookRules();
                this.dailyChecklist = this.loadDailyChecklist();
                this.init();
            }

            init() {
                if (this.accounts.length === 0) {
                    this.createDefaultAccount();
                }
                this.applyTheme();
                this.setupEventListeners();
                this.initGoogleDrive();
                this.updateAllDisplays();
                document.getElementById('tradeDate').valueAsDate = new Date();
            }

            loadSettings() {
                const defaultSettings = { monthlyGoal: 4, dailyGoal: 0.2 };
                const saved = localStorage.getItem('tradeJournalSettings');
                return saved ? JSON.parse(saved) : defaultSettings;
            }

            saveSettings() {
                localStorage.setItem('tradeJournalSettings', JSON.stringify(this.settings));
            }

            loadAccounts() {
                const saved = localStorage.getItem('tradeJournalAccounts');
                return saved ? JSON.parse(saved) : [];
            }

            saveAccounts() {
                localStorage.setItem('tradeJournalAccounts', JSON.stringify(this.accounts));
                this.saveToDrive();
            }

            loadCurrentAccountId() {
                const saved = localStorage.getItem('currentAccountId');
                return saved ? parseInt(saved) : null;
            }

            saveCurrentAccountId() {
                localStorage.setItem('currentAccountId', this.currentAccountId);
            }

            createDefaultAccount() {
                const defaultAccount = {
                    id: Date.now(),
                    name: 'Compte Principal',
                    propFirm: 'Personnel',
                    baseCapital: 50000,
                    isBurned: false
                };
                this.accounts.push(defaultAccount);
                this.currentAccountId = defaultAccount.id;
                this.saveAccounts();
                this.saveCurrentAccountId();
            }

            getCurrentAccount() {
                return this.accounts.find(a => a.id === this.currentAccountId) || this.accounts[0];
            }

            loadTrades() {
                const saved = localStorage.getItem('tradeJournalTrades');
                return saved ? JSON.parse(saved) : [];
            }

            saveTrades() {
                localStorage.setItem('tradeJournalTrades', JSON.stringify(this.trades));
                this.saveToDrive();
            }

            setupEventListeners() {
                // Menu navigation
                document.querySelectorAll('.menu-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        const view = e.currentTarget.dataset.view;
                        this.switchView(view);
                    });
                });

                // Instrument select change
                document.getElementById('instrument').addEventListener('change', (e) => {
                    const customGroup = document.getElementById('customInstrumentGroup');
                    if (e.target.value === 'AUTRE') {
                        customGroup.style.display = 'block';
                        document.getElementById('customInstrument').required = true;
                    } else {
                        customGroup.style.display = 'none';
                        document.getElementById('customInstrument').required = false;
                    }
                });

                // Trade form
                document.getElementById('tradeForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addTrade();
                });

                // Account form
                document.getElementById('accountForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addAccount();
                });

                // Filter pills
                document.querySelectorAll('.filter-pill').forEach(pill => {
                    pill.addEventListener('click', (e) => {
                        document.querySelectorAll('.filter-pill').forEach(p => p.classList.remove('active'));
                        e.target.classList.add('active');
                        this.currentFilter = e.target.dataset.filter;
                        this.renderTrades();
                    });
                });
            }

            switchView(viewName) {
                this.currentView = viewName;
                
                document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
                document.querySelector(`[data-view="${viewName}"]`).classList.add('active');
                
                document.querySelectorAll('.view').forEach(view => view.classList.remove('active'));
                document.getElementById(viewName).classList.add('active');

                const titles = {
                    dashboard: 'Dashboard',
                    trades: 'Trades',
                    payouts: 'Payouts',
                    statistics: 'Statistiques',
                    globalStats: 'Statistiques Globales',
                    journal: 'Journal',
                    playbook: 'Playbook'
                };
                document.getElementById('pageTitle').textContent = titles[viewName];

                if (viewName === 'statistics') {
                    this.updateStatistics();
                } else if (viewName === 'globalStats') {
                    this.updateGlobalStatistics();
                } else if (viewName === 'payouts') {
                    this.updatePayoutsView();
                } else if (viewName === 'playbook') {
                    this.renderPlaybookView();
                }

                // Close mobile menu after navigation
                this.closeMobileMenu();
            }

            toggleMobileMenu() {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('mobileOverlay');
                sidebar.classList.toggle('mobile-open');
                overlay.classList.toggle('active');
            }

            closeMobileMenu() {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('mobileOverlay');
                sidebar.classList.remove('mobile-open');
                overlay.classList.remove('active');
            }

            openTradeModal() {
                document.getElementById('tradeModal').classList.add('active');
            }

            closeTradeModal() {
                document.getElementById('tradeModal').classList.remove('active');
                document.getElementById('tradeForm').reset();
                document.getElementById('customInstrumentGroup').style.display = 'none';
                document.getElementById('customInstrument').required = false;
                // Reset payout mode
                this.togglePayoutMode(false);
            }

            togglePayoutMode(isPayoutMode) {
                const instrument = document.getElementById('instrument');
                const tradeType = document.getElementById('tradeType');
                const positionSize = document.getElementById('positionSize');
                const tradingViewLink = document.getElementById('tradingViewLink');
                const followedStrategy = document.getElementById('followedStrategy');
                
                if (isPayoutMode) {
                    // Disable fields for payout
                    instrument.disabled = true;
                    tradeType.disabled = true;
                    positionSize.disabled = true;
                    tradingViewLink.disabled = true;
                    followedStrategy.disabled = true;
                    
                    // Set default values
                    instrument.value = '';
                    tradeType.value = 'LONG';
                    positionSize.value = '';
                    tradingViewLink.value = '';
                    followedStrategy.checked = false;
                } else {
                    // Enable fields for normal trade
                    instrument.disabled = false;
                    tradeType.disabled = false;
                    positionSize.disabled = false;
                    tradingViewLink.disabled = false;
                    followedStrategy.disabled = false;
                }
            }

            openAccountModal() {
                this.renderAccountList();
                document.getElementById('accountModal').classList.add('active');
            }

            closeAccountModal() {
                document.getElementById('accountModal').classList.remove('active');
                this.hideAddAccountForm();
            }

            showAddAccountForm() {
                document.getElementById('addAccountForm').style.display = 'block';
            }

            hideAddAccountForm() {
                document.getElementById('addAccountForm').style.display = 'none';
                document.getElementById('accountForm').reset();
            }

            renderAccountList() {
                const list = document.getElementById('accountList');
                
                // Separate active and burned accounts
                const activeAccounts = this.accounts.filter(acc => !acc.isBurned);
                const burnedAccounts = this.accounts.filter(acc => acc.isBurned);

                let html = '';

                // Active accounts
                if (activeAccounts.length > 0) {
                    html += activeAccounts.map(acc => {
                        const accTrades = this.trades.filter(t => t.accountId === acc.id);
                        const accPnL = accTrades.reduce((s, t) => s + t.pnl, 0);
                        const accCapital = acc.baseCapital + accPnL;
                        const isActive = acc.id === this.currentAccountId;

                        return `
                            <div class="account-item ${isActive ? 'active' : ''}" onclick="journal.selectAccount(${acc.id})">
                                <div class="account-info">
                                    <h4>${acc.name}</h4>
                                    <p>üè¢ ${acc.propFirm}</p>
                                </div>
                                <div style="text-align: right;">
                                    <div class="account-value" style="color: ${accPnL >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}">
                                        ${this.formatCurrency(accCapital)}
                                    </div>
                                    <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem; flex-wrap: wrap;">
                                        <button class="rename-account-btn" data-account-id="${acc.id}" style="padding: 0.25rem 0.75rem; background: transparent; border: 1px solid var(--accent-primary); color: var(--accent-primary); border-radius: 4px; cursor: pointer; font-size: 0.75rem;" title="Renommer">
                                            ‚úèÔ∏è
                                        </button>
                                        <button class="burn-account-btn" data-account-id="${acc.id}" style="padding: 0.25rem 0.75rem; background: transparent; border: 1px solid var(--accent-red); color: var(--accent-red); border-radius: 4px; cursor: pointer; font-size: 0.75rem;">
                                            üî• Griller
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                }

                // Burned accounts section
                if (burnedAccounts.length > 0) {
                    html += `
                        <div style="margin: 1.5rem 0 0.75rem; padding-top: 1.5rem; border-top: 1px solid var(--border);">
                            <div style="font-size: 0.85rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; font-weight: 600; margin-bottom: 0.75rem;">
                                Comptes Grill√©s (${burnedAccounts.length})
                            </div>
                        </div>
                    `;
                    
                    html += burnedAccounts.map(acc => {
                        const accTrades = this.trades.filter(t => t.accountId === acc.id);
                        const accPnL = accTrades.reduce((s, t) => s + t.pnl, 0);
                        const accCapital = acc.baseCapital + accPnL;

                        return `
                            <div class="account-item" style="opacity: 0.6; cursor: not-allowed; background: var(--bg-secondary);">
                                <div class="account-info">
                                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                                        <h4 style="margin: 0;">${acc.name}</h4>
                                        <span style="background: var(--accent-red); color: white; padding: 0.15rem 0.5rem; border-radius: 4px; font-size: 0.7rem; font-weight: 700;">GRILL√â</span>
                                    </div>
                                    <p>üè¢ ${acc.propFirm}</p>
                                </div>
                                <div style="text-align: right;">
                                    <div class="account-value" style="color: var(--text-secondary)">
                                        ${this.formatCurrency(accCapital)}
                                    </div>
                                    <button class="burn-account-btn" data-account-id="${acc.id}" style="margin-top: 0.5rem; padding: 0.25rem 0.75rem; background: transparent; border: 1px solid var(--accent-green); color: var(--accent-green); border-radius: 4px; cursor: pointer; font-size: 0.75rem;">
                                        ‚úÖ R√©activer
                                    </button>
                                </div>
                            </div>
                        `;
                    }).join('');
                }

                list.innerHTML = html;

                // Add event listeners to buttons
                document.querySelectorAll('.rename-account-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const accountId = parseInt(btn.dataset.accountId);
                        this.renameAccount(accountId);
                    });
                });

                document.querySelectorAll('.burn-account-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const accountId = parseInt(btn.dataset.accountId);
                        this.toggleBurnAccount(accountId);
                    });
                });
            }

            selectAccount(id) {
                const account = this.accounts.find(a => a.id === id);
                if (account && account.isBurned) {
                    alert('‚ö†Ô∏è Ce compte est grill√©. R√©activez-le pour pouvoir l\'utiliser.');
                    return;
                }
                this.currentAccountId = id;
                this.saveCurrentAccountId();
                document.getElementById('currentAccountDisplay').textContent = account.name;
                this.closeAccountModal();
                this.updateAllDisplays();
            }

            renameAccount(id) {
                const account = this.accounts.find(a => a.id === id);
                if (!account) return;

                const newName = prompt(`Renommer le compte "${account.name}"`, account.name);
                if (newName && newName.trim() && newName !== account.name) {
                    account.name = newName.trim();
                    this.saveAccounts();
                    this.renderAccountList();
                    
                    // Update display if it's the current account
                    if (this.currentAccountId === id) {
                        this.updateAllDisplays();
                    }
                }
            }

            toggleBurnAccount(id) {
                const account = this.accounts.find(a => a.id === id);
                if (!account) return;

                if (account.isBurned) {
                    // R√©activer
                    if (confirm(`R√©activer le compte "${account.name}" ?`)) {
                        account.isBurned = false;
                        this.saveAccounts();
                        this.renderAccountList();
                    }
                } else {
                    // Griller
                    if (confirm(`‚ö†Ô∏è Griller le compte "${account.name}" ?\n\nLe compte sera d√©sactiv√© mais l'historique sera conserv√©.`)) {
                        account.isBurned = true;
                        
                        // Si c'est le compte actif, switch vers un autre
                        if (this.currentAccountId === id) {
                            const activeAccounts = this.accounts.filter(a => !a.isBurned && a.id !== id);
                            if (activeAccounts.length > 0) {
                                this.currentAccountId = activeAccounts[0].id;
                                this.saveCurrentAccountId();
                                document.getElementById('currentAccountDisplay').textContent = activeAccounts[0].name;
                            }
                        }
                        
                        this.saveAccounts();
                        this.renderAccountList();
                        this.updateAllDisplays();
                    }
                }
            }

            addAccount() {
                const account = {
                    id: Date.now(),
                    name: document.getElementById('accountName').value,
                    propFirm: document.getElementById('propFirm').value,
                    baseCapital: parseFloat(document.getElementById('accountCapital').value),
                    isBurned: false
                };

                this.accounts.push(account);
                this.saveAccounts();
                this.hideAddAccountForm();
                this.renderAccountList();
            }

            addTrade() {
                let instrumentValue = document.getElementById('instrument').value;
                
                // If "AUTRE" is selected, use custom instrument
                if (instrumentValue === 'AUTRE') {
                    instrumentValue = document.getElementById('customInstrument').value.toUpperCase();
                }

                const isPayout = document.getElementById('isPayout').checked;

                const trade = {
                    id: Date.now(),
                    accountId: this.currentAccountId,
                    date: document.getElementById('tradeDate').value,
                    instrument: instrumentValue,
                    type: document.getElementById('tradeType').value,
                    pnl: parseFloat(document.getElementById('pnl').value),
                    size: parseFloat(document.getElementById('positionSize').value),
                    tradingViewLink: document.getElementById('tradingViewLink').value,
                    followedStrategy: document.getElementById('followedStrategy').checked,
                    notes: document.getElementById('notes').value,
                    isPayout: isPayout
                };

                // Si c'est un payout, le P&L doit √™tre n√©gatif
                if (isPayout && trade.pnl > 0) {
                    trade.pnl = -trade.pnl;
                }

                const currentCapital = this.getCurrentCapital();
                trade.pnlPercent = (trade.pnl / currentCapital) * 100;

                this.trades.unshift(trade);
                this.saveTrades();
                this.closeTradeModal();
                this.updateAllDisplays();
            }

            deleteTrade(id) {
                if (confirm('Supprimer ce trade ?')) {
                    this.trades = this.trades.filter(t => t.id !== id);
                    this.saveTrades();
                    this.updateAllDisplays();
                }
            }

            getCurrentCapital() {
                const account = this.getCurrentAccount();
                const accountTrades = this.trades.filter(t => t.accountId === this.currentAccountId);
                const totalPnL = accountTrades.reduce((sum, t) => sum + t.pnl, 0);
                return account.baseCapital + totalPnL;
            }

            getAccountTrades() {
                return this.trades.filter(t => t.accountId === this.currentAccountId && !t.isPayout);
            }

            getAccountPayouts() {
                return this.trades.filter(t => t.accountId === this.currentAccountId && t.isPayout);
            }

            getAllPayouts() {
                return this.trades.filter(t => t.isPayout);
            }

            previousMonth() {
                this.currentMonth = new Date(this.currentMonth.getFullYear(), this.currentMonth.getMonth() - 1);
                this.renderCalendar();
            }

            nextMonth() {
                this.currentMonth = new Date(this.currentMonth.getFullYear(), this.currentMonth.getMonth() + 1);
                this.renderCalendar();
            }

            renderCalendar() {
                const months = ['Janvier', 'F√©vrier', 'Mars', 'Avril', 'Mai', 'Juin', 
                               'Juillet', 'Ao√ªt', 'Septembre', 'Octobre', 'Novembre', 'D√©cembre'];
                
                document.getElementById('calendarMonth').textContent = 
                    `${months[this.currentMonth.getMonth()]} ${this.currentMonth.getFullYear()}`;

                const firstDay = new Date(this.currentMonth.getFullYear(), this.currentMonth.getMonth(), 1);
                const lastDay = new Date(this.currentMonth.getFullYear(), this.currentMonth.getMonth() + 1, 0);
                const daysInMonth = lastDay.getDate();
                const startDay = firstDay.getDay();

                const grid = document.getElementById('calendarGrid');
                grid.innerHTML = '';

                // Day headers
                const dayNames = ['Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam'];
                dayNames.forEach(day => {
                    const header = document.createElement('div');
                    header.className = 'calendar-day-header';
                    header.textContent = day;
                    grid.appendChild(header);
                });

                // Empty cells before first day
                for (let i = 0; i < startDay; i++) {
                    grid.appendChild(document.createElement('div'));
                }

                // Days
                const today = new Date();
                const accountTrades = this.getAccountTrades();

                for (let day = 1; day <= daysInMonth; day++) {
                    const dayDate = new Date(this.currentMonth.getFullYear(), this.currentMonth.getMonth(), day);
                    const dayTrades = accountTrades.filter(t => {
                        const tradeDate = new Date(t.date);
                        return tradeDate.toDateString() === dayDate.toDateString();
                    });

                    const dayPnL = dayTrades.reduce((sum, t) => sum + t.pnl, 0);
                    
                    const dayEl = document.createElement('div');
                    dayEl.className = 'calendar-day';
                    
                    if (dayDate.toDateString() === today.toDateString()) {
                        dayEl.classList.add('today');
                    }
                    
                    if (dayTrades.length > 0) {
                        dayEl.classList.add('has-trades');
                        if (dayPnL > 0) dayEl.classList.add('profit');
                        if (dayPnL < 0) dayEl.classList.add('loss');
                    }

                    dayEl.innerHTML = `
                        <div class="calendar-day-number">${day}</div>
                        ${dayTrades.length > 0 ? `
                            <div class="calendar-day-pnl" style="color: ${dayPnL >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}">
                                ${dayPnL >= 0 ? '+' : ''}${dayPnL.toFixed(0)}‚Ç¨
                            </div>
                            <div class="calendar-day-trades">${dayTrades.length} trade${dayTrades.length > 1 ? 's' : ''}</div>
                        ` : ''}
                    `;

                    // Make days with trades clickable
                    if (dayTrades.length > 0) {
                        dayEl.style.cursor = 'pointer';
                        dayEl.onclick = () => this.showDayTrades(dayDate, dayTrades);
                    }

                    grid.appendChild(dayEl);
                }
            }

            showDayTrades(date, trades) {
                const formattedDate = date.toLocaleDateString('fr-FR', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                
                document.getElementById('dayTradesTitle').textContent = `Trades du ${formattedDate}`;
                
                const totalPnL = trades.reduce((sum, t) => sum + t.pnl, 0);
                const wins = trades.filter(t => t.pnl > 0).length;
                const losses = trades.filter(t => t.pnl < 0).length;
                
                const container = document.getElementById('dayTradesContainer');
                container.innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                        <div style="background: var(--bg-card); padding: 1rem; border-radius: 8px; border: 1px solid var(--border);">
                            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem;">P&L Total</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: ${totalPnL >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}">
                                ${totalPnL >= 0 ? '+' : ''}${this.formatCurrency(totalPnL)}
                            </div>
                        </div>
                        <div style="background: var(--bg-card); padding: 1rem; border-radius: 8px; border: 1px solid var(--border);">
                            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Trades</div>
                            <div style="font-size: 1.5rem; font-weight: 700;">${trades.length}</div>
                        </div>
                        <div style="background: var(--bg-card); padding: 1rem; border-radius: 8px; border: 1px solid var(--border);">
                            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Gains / Pertes</div>
                            <div style="font-size: 1.5rem; font-weight: 700;">
                                <span style="color: var(--accent-green);">${wins}</span> / 
                                <span style="color: var(--accent-red);">${losses}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="max-height: 400px; overflow-y: auto;">
                        <table style="width: 100%;">
                            <thead>
                                <tr>
                                    <th style="text-align: left; padding: 0.75rem; border-bottom: 1px solid var(--border);">Instrument</th>
                                    <th style="text-align: left; padding: 0.75rem; border-bottom: 1px solid var(--border);">Type</th>
                                    <th style="text-align: right; padding: 0.75rem; border-bottom: 1px solid var(--border);">P&L</th>
                                    <th style="text-align: right; padding: 0.75rem; border-bottom: 1px solid var(--border);">%</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${trades.map(trade => `
                                    <tr>
                                        <td style="padding: 0.75rem; border-bottom: 1px solid var(--border);">
                                            <strong>${trade.instrument || '-'}</strong>
                                        </td>
                                        <td style="padding: 0.75rem; border-bottom: 1px solid var(--border);">
                                            <span style="color: ${trade.type === 'LONG' ? 'var(--accent-green)' : 'var(--accent-red)'}">
                                                ${trade.type || '-'}
                                            </span>
                                        </td>
                                        <td style="padding: 0.75rem; border-bottom: 1px solid var(--border); text-align: right;">
                                            <span style="color: ${trade.pnl >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}; font-weight: 600;">
                                                ${trade.pnl >= 0 ? '+' : ''}${this.formatCurrency(trade.pnl)}
                                            </span>
                                        </td>
                                        <td style="padding: 0.75rem; border-bottom: 1px solid var(--border); text-align: right;">
                                            <span style="color: ${trade.pnlPercent >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}">
                                                ${trade.pnlPercent >= 0 ? '+' : ''}${trade.pnlPercent.toFixed(2)}%
                                            </span>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                
                document.getElementById('dayTradesModal').classList.add('active');
            }

            closeDayTradesModal() {
                document.getElementById('dayTradesModal').classList.remove('active');
            }

            renderWeeksSummary() {
                const accountTrades = this.getAccountTrades();
                const now = new Date();
                const weeks = [];

                for (let week = 1; week <= 4; week++) {
                    const weekTrades = accountTrades.filter(t => {
                        const tradeDate = new Date(t.date);
                        return tradeDate.getMonth() === now.getMonth() &&
                               tradeDate.getFullYear() === now.getFullYear() &&
                               this.getWeekNumber(t.date) === week;
                    });

                    const weekPnL = weekTrades.reduce((sum, t) => sum + t.pnl, 0);
                    const weekWins = weekTrades.filter(t => t.pnl > 0).length;
                    
                    weeks.push({
                        number: week,
                        pnl: weekPnL,
                        trades: weekTrades.length,
                        wins: weekWins
                    });
                }

                const html = weeks.map(week => `
                    <div class="week-item">
                        <div class="week-label">Semaine ${week.number}</div>
                        <div class="week-pnl" style="color: ${week.pnl >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}">
                            ${week.pnl >= 0 ? '+' : ''}${this.formatCurrency(week.pnl)}
                        </div>
                        <div class="week-stats">${week.trades} trades ¬∑ ${week.wins}W</div>
                    </div>
                `).join('');

                document.getElementById('weeksSummary').innerHTML = html;
            }

            getWeekNumber(date) {
                const d = new Date(date);
                const firstDay = new Date(d.getFullYear(), d.getMonth(), 1);
                const dayOfMonth = d.getDate();
                return Math.ceil((dayOfMonth + firstDay.getDay()) / 7);
            }

            filterTrades() {
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                const weekAgo = new Date(today);
                weekAgo.setDate(weekAgo.getDate() - 7);
                const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);

                return this.getAccountTrades().filter(trade => {
                    const tradeDate = new Date(trade.date);
                    
                    switch(this.currentFilter) {
                        case 'month':
                            return tradeDate >= monthStart;
                        case 'week':
                            return tradeDate >= weekAgo;
                        case 'wins':
                            return trade.pnl > 0;
                        case 'losses':
                            return trade.pnl < 0;
                        default:
                            return true;
                    }
                });
            }

            renderTrades() {
                const tbody = document.getElementById('tradesTableBody');
                const filteredTrades = this.filterTrades();

                if (filteredTrades.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="9" class="empty-state">
                                <div class="empty-icon">üìä</div>
                                <div>Aucun trade trouv√©</div>
                            </td>
                        </tr>
                    `;
                    
                    // Also update mobile cards container
                    const cardsContainer = document.getElementById('tradesCardsContainer');
                    if (cardsContainer) {
                        cardsContainer.innerHTML = `
                            <div class="empty-state" style="display: flex; flex-direction: column; align-items: center; padding: 2rem; color: var(--text-secondary);">
                                <div class="empty-icon">üìä</div>
                                <div>Aucun trade trouv√©</div>
                            </div>
                        `;
                    }
                    return;
                }

                // Table rows for desktop
                tbody.innerHTML = filteredTrades.map(trade => `
                    <tr>
                        <td>${new Date(trade.date).toLocaleDateString('fr-FR')}</td>
                        <td style="font-weight: 600;">${trade.instrument || '-'}</td>
                        <td><span class="trade-type-badge ${trade.type ? trade.type.toLowerCase() : ''}">${trade.type || '-'}</span></td>
                        <td>${trade.size || '-'}</td>
                        <td class="pnl-value ${trade.pnl >= 0 ? 'positive' : 'negative'}">
                            ${trade.pnl >= 0 ? '+' : ''}${trade.pnl.toFixed(2)}‚Ç¨
                        </td>
                        <td style="color: ${trade.pnl >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}">
                            ${trade.pnl >= 0 ? '+' : ''}${trade.pnlPercent.toFixed(2)}%
                        </td>
                        <td>${trade.followedStrategy ? '‚úÖ' : '‚ùå'}</td>
                        <td>
                            ${trade.tradingViewLink ? 
                                `<a href="${trade.tradingViewLink}" target="_blank" style="color: var(--accent-primary);">üìà</a>` : 
                                '-'}
                        </td>
                        <td>
                            <button onclick="journal.deleteTrade(${trade.id})" style="background: var(--accent-red); color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">√ó</button>
                        </td>
                    </tr>
                `).join('');

                // Mobile cards
                const cardsContainer = document.getElementById('tradesCardsContainer');
                if (cardsContainer) {
                    cardsContainer.innerHTML = filteredTrades.map(trade => `
                        <div class="trade-card">
                            <div class="trade-card-header">
                                <div>
                                    <div style="font-weight: 700; font-size: 1.1rem; margin-bottom: 0.25rem;">
                                        ${trade.instrument || '-'}
                                    </div>
                                    <div style="font-size: 0.85rem; color: var(--text-secondary);">
                                        ${new Date(trade.date).toLocaleDateString('fr-FR')}
                                    </div>
                                </div>
                                <div class="pnl-value ${trade.pnl >= 0 ? 'positive' : 'negative'}" style="font-size: 1.3rem; font-weight: 700;">
                                    ${trade.pnl >= 0 ? '+' : ''}${trade.pnl.toFixed(2)}‚Ç¨
                                </div>
                            </div>
                            <div class="trade-card-body">
                                <div class="trade-card-field">
                                    <div class="trade-card-label">Type</div>
                                    <div class="trade-card-value">
                                        <span class="trade-type-badge ${trade.type ? trade.type.toLowerCase() : ''}">${trade.type || '-'}</span>
                                    </div>
                                </div>
                                <div class="trade-card-field">
                                    <div class="trade-card-label">Taille</div>
                                    <div class="trade-card-value">${trade.size || '-'} lots</div>
                                </div>
                                <div class="trade-card-field">
                                    <div class="trade-card-label">% Capital</div>
                                    <div class="trade-card-value" style="color: ${trade.pnl >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}">
                                        ${trade.pnl >= 0 ? '+' : ''}${trade.pnlPercent.toFixed(2)}%
                                    </div>
                                </div>
                                <div class="trade-card-field">
                                    <div class="trade-card-label">Strat√©gie</div>
                                    <div class="trade-card-value">${trade.followedStrategy ? '‚úÖ Oui' : '‚ùå Non'}</div>
                                </div>
                            </div>
                            <div class="trade-card-actions">
                                ${trade.tradingViewLink ? 
                                    `<a href="${trade.tradingViewLink}" target="_blank" class="btn btn-outline" style="flex: 1; text-align: center; padding: 0.5rem; font-size: 0.85rem;">üìà Chart</a>` : 
                                    ''}
                                <button onclick="journal.deleteTrade(${trade.id})" class="btn" style="background: var(--accent-red); flex: ${trade.tradingViewLink ? '0' : '1'}; padding: 0.5rem 1rem; font-size: 0.85rem;">Supprimer</button>
                            </div>
                        </div>
                    `).join('');
                }
            }

            updateAllDisplays() {
                const account = this.getCurrentAccount();
                const displayText = account.isBurned 
                    ? `${account.name} üî•` 
                    : account.name;
                document.getElementById('currentAccountDisplay').textContent = displayText;
                
                this.updateWidgets();
                this.renderCalendar();
                this.renderWeeksSummary();
                this.renderTrades();
            }

            updateWidgets() {
                const account = this.getCurrentAccount();
                const accountTrades = this.getAccountTrades();
                const currentCapital = this.getCurrentCapital();
                const totalPnL = accountTrades.reduce((sum, t) => sum + t.pnl, 0);
                const capitalGrowth = ((currentCapital - account.baseCapital) / account.baseCapital) * 100;

                const wins = accountTrades.filter(t => t.pnl > 0).length;
                const losses = accountTrades.filter(t => t.pnl < 0).length;
                const winRate = accountTrades.length > 0 ? (wins / accountTrades.length * 100).toFixed(1) : 0;

                const now = new Date();
                const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
                const monthlyTrades = accountTrades.filter(t => new Date(t.date) >= monthStart);
                const monthlyPnL = monthlyTrades.reduce((sum, t) => sum + t.pnl, 0);
                const monthlyGoal = account.baseCapital * (this.settings.monthlyGoal / 100);
                const monthlyProgress = (monthlyPnL / monthlyGoal * 100).toFixed(1);

                document.getElementById('widgetCapital').textContent = this.formatCurrency(currentCapital);
                document.getElementById('widgetCapitalChange').innerHTML = `
                    <span>${capitalGrowth >= 0 ? '‚ñ≤' : '‚ñº'}</span>
                    <span>${capitalGrowth >= 0 ? '+' : ''}${capitalGrowth.toFixed(2)}%</span>
                `;
                document.getElementById('widgetCapitalChange').className = `widget-change ${capitalGrowth >= 0 ? 'positive' : 'negative'}`;

                document.getElementById('widgetPnL').textContent = this.formatCurrency(totalPnL);
                document.getElementById('widgetPnL').style.color = totalPnL >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
                document.getElementById('widgetPnLChange').innerHTML = `
                    <span>‚óè</span>
                    <span>${accountTrades.length} trades</span>
                `;

                document.getElementById('widgetWinRate').textContent = `${winRate}%`;
                document.getElementById('widgetWinRate').style.color = winRate >= 50 ? 'var(--accent-green)' : 'var(--accent-red)';
                document.getElementById('widgetWinRateChange').innerHTML = `
                    <span>‚óã</span>
                    <span>${wins}W / ${losses}L</span>
                `;

                document.getElementById('widgetMonthlyPnL').textContent = this.formatCurrency(monthlyPnL);
                document.getElementById('widgetMonthlyPnL').style.color = monthlyPnL >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
                document.getElementById('widgetMonthlyProgress').innerHTML = `
                    <span>‚óê</span>
                    <span>${monthlyProgress}%</span>
                `;
            }

            updateStatistics() {
                const account = this.getCurrentAccount();
                const accountTrades = this.getAccountTrades();

                document.getElementById('statsAccountName').textContent = account.name;

                // Day performance
                const days = ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi', 'Dimanche'];
                const dayPnL = {};
                days.forEach(day => dayPnL[day] = 0);

                accountTrades.forEach(trade => {
                    const date = new Date(trade.date);
                    const dayIndex = date.getDay();
                    const dayName = days[dayIndex === 0 ? 6 : dayIndex - 1];
                    dayPnL[dayName] += trade.pnl;
                });

                const maxPnL = Math.max(...Object.values(dayPnL), 1);

                document.getElementById('dayPerformance').innerHTML = days.map(day => {
                    const pnl = dayPnL[day];
                    const percentage = (Math.abs(pnl) / maxPnL) * 100;
                    return `
                        <div class="day-row">
                            <div class="day-name">${day}</div>
                            <div class="day-bar-container">
                                <div class="day-bar-fill" style="width: ${percentage}%"></div>
                            </div>
                            <div class="day-value" style="color: ${pnl >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}">
                                ${pnl >= 0 ? '+' : ''}${pnl.toFixed(0)}‚Ç¨
                            </div>
                        </div>
                    `;
                }).join('');

                // Long vs Short
                const longTrades = accountTrades.filter(t => t.type === 'LONG');
                const shortTrades = accountTrades.filter(t => t.type === 'SHORT');
                
                const longPnL = longTrades.reduce((sum, t) => sum + t.pnl, 0);
                const shortPnL = shortTrades.reduce((sum, t) => sum + t.pnl, 0);
                
                const longWins = longTrades.filter(t => t.pnl > 0).length;
                const shortWins = shortTrades.filter(t => t.pnl > 0).length;
                
                const longWR = longTrades.length > 0 ? (longWins / longTrades.length * 100).toFixed(0) : 0;
                const shortWR = shortTrades.length > 0 ? (shortWins / shortTrades.length * 100).toFixed(0) : 0;

                document.getElementById('statsLongPnL').textContent = this.formatCurrency(longPnL);
                document.getElementById('statsLongPnL').style.color = longPnL >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
                document.getElementById('statsLongInfo').textContent = `${longTrades.length} trades | ${longWR}% WR`;

                document.getElementById('statsShortPnL').textContent = this.formatCurrency(shortPnL);
                document.getElementById('statsShortPnL').style.color = shortPnL >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
                document.getElementById('statsShortInfo').textContent = `${shortTrades.length} trades | ${shortWR}% WR`;

                // Strategy adherence
                const tradesWithStrategy = accountTrades.filter(t => t.followedStrategy);
                const adherence = accountTrades.length > 0 ? (tradesWithStrategy.length / accountTrades.length * 100).toFixed(1) : 0;

                document.getElementById('statsStrategyPercent').textContent = `${adherence}%`;
                document.getElementById('statsStrategyPercent').style.color = adherence >= 70 ? 'var(--accent-green)' : 'var(--accent-red)';
                document.getElementById('statsStrategyDetails').textContent = `${tradesWithStrategy.length} / ${accountTrades.length} trades`;

                const withStrategyPnL = tradesWithStrategy.reduce((sum, t) => sum + t.pnl, 0);
                const withStrategyWins = tradesWithStrategy.filter(t => t.pnl > 0).length;
                const withStrategyWR = tradesWithStrategy.length > 0 ? (withStrategyWins / tradesWithStrategy.length * 100).toFixed(0) : 0;

                const withoutStrategy = accountTrades.filter(t => !t.followedStrategy);
                const withoutStrategyPnL = withoutStrategy.reduce((sum, t) => sum + t.pnl, 0);
                const withoutStrategyWins = withoutStrategy.filter(t => t.pnl > 0).length;
                const withoutStrategyWR = withoutStrategy.length > 0 ? (withoutStrategyWins / withoutStrategy.length * 100).toFixed(0) : 0;

                document.getElementById('statsWithStrategy').innerHTML = `
                    <span style="color: ${withStrategyPnL >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}; font-size: 1.25rem; font-family: 'Manrope', sans-serif;">
                        ${this.formatCurrency(withStrategyPnL)}
                    </span> ‚Ä¢ ${withStrategyWR}% WR
                `;

                document.getElementById('statsWithoutStrategy').innerHTML = `
                    <span style="color: ${withoutStrategyPnL >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}; font-size: 1.25rem; font-family: 'Manrope', sans-serif;">
                        ${this.formatCurrency(withoutStrategyPnL)}
                    </span> ‚Ä¢ ${withoutStrategyWR}% WR
                `;

                // Best instruments
                const instrumentPnL = {};
                accountTrades.forEach(trade => {
                    if (!instrumentPnL[trade.instrument]) {
                        instrumentPnL[trade.instrument] = 0;
                    }
                    instrumentPnL[trade.instrument] += trade.pnl;
                });

                const sortedInstruments = Object.entries(instrumentPnL)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5);

                document.getElementById('statsBestInstruments').innerHTML = sortedInstruments.length > 0 
                    ? sortedInstruments.map(([instrument, pnl]) => `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: var(--bg-secondary); border-radius: 8px;">
                            <span style="font-weight: 600;">${instrument}</span>
                            <span style="font-family: 'Manrope', sans-serif; font-weight: 700; font-size: 1.1rem; color: ${pnl >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}">
                                ${pnl >= 0 ? '+' : ''}${pnl.toFixed(0)}‚Ç¨
                            </span>
                        </div>
                    `).join('')
                    : '<div style="color: var(--text-secondary); text-align: center;">Pas encore de donn√©es</div>';
            }

            updateGlobalStatistics() {
                const allTrades = this.trades;

                // Global summary
                const totalCapital = this.accounts.reduce((sum, acc) => {
                    const accTrades = this.trades.filter(t => t.accountId === acc.id);
                    const accPnL = accTrades.reduce((s, t) => s + t.pnl, 0);
                    return sum + acc.baseCapital + accPnL;
                }, 0);

                const totalPnL = allTrades.reduce((sum, t) => sum + t.pnl, 0);
                const wins = allTrades.filter(t => t.pnl > 0).length;
                const losses = allTrades.filter(t => t.pnl < 0).length;
                const winRate = allTrades.length > 0 ? (wins / allTrades.length * 100).toFixed(1) : 0;

                // Best account
                let bestAccount = null;
                let bestAccountPnL = -Infinity;
                this.accounts.forEach(acc => {
                    const accTrades = this.trades.filter(t => t.accountId === acc.id);
                    const accPnL = accTrades.reduce((s, t) => s + t.pnl, 0);
                    if (accPnL > bestAccountPnL) {
                        bestAccountPnL = accPnL;
                        bestAccount = acc;
                    }
                });

                document.getElementById('globalCapitalWidget').textContent = this.formatCurrency(totalCapital);
                document.getElementById('globalAccountsCount').innerHTML = `
                    <span>‚óè</span>
                    <span>${this.accounts.length} compte${this.accounts.length > 1 ? 's' : ''}</span>
                `;

                document.getElementById('globalPnLWidget').textContent = this.formatCurrency(totalPnL);
                document.getElementById('globalPnLWidget').style.color = totalPnL >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
                document.getElementById('globalTradesCount').innerHTML = `
                    <span>‚óè</span>
                    <span>${allTrades.length} trades</span>
                `;

                document.getElementById('globalWinRateWidget').textContent = `${winRate}%`;
                document.getElementById('globalWinRateWidget').style.color = winRate >= 50 ? 'var(--accent-green)' : 'var(--accent-red)';
                document.getElementById('globalWinRateDetails').innerHTML = `
                    <span>‚óã</span>
                    <span>${wins}W / ${losses}L</span>
                `;

                if (bestAccount) {
                    document.getElementById('globalBestAccount').textContent = bestAccount.name;
                    document.getElementById('globalBestAccountPnL').innerHTML = `
                        <span>‚ñ≤</span>
                        <span>${this.formatCurrency(bestAccountPnL)}</span>
                    `;
                    document.getElementById('globalBestAccountPnL').style.color = bestAccountPnL >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
                }

                // Global day performance
                const days = ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi', 'Dimanche'];
                const dayPnL = {};
                days.forEach(day => dayPnL[day] = 0);

                allTrades.forEach(trade => {
                    const date = new Date(trade.date);
                    const dayIndex = date.getDay();
                    const dayName = days[dayIndex === 0 ? 6 : dayIndex - 1];
                    dayPnL[dayName] += trade.pnl;
                });

                const maxPnL = Math.max(...Object.values(dayPnL), 1);

                document.getElementById('globalDayPerformance').innerHTML = days.map(day => {
                    const pnl = dayPnL[day];
                    const percentage = (Math.abs(pnl) / maxPnL) * 100;
                    return `
                        <div class="day-row">
                            <div class="day-name">${day}</div>
                            <div class="day-bar-container">
                                <div class="day-bar-fill" style="width: ${percentage}%"></div>
                            </div>
                            <div class="day-value" style="color: ${pnl >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}">
                                ${pnl >= 0 ? '+' : ''}${pnl.toFixed(0)}‚Ç¨
                            </div>
                        </div>
                    `;
                }).join('');

                // Global Long vs Short
                const longTrades = allTrades.filter(t => t.type === 'LONG');
                const shortTrades = allTrades.filter(t => t.type === 'SHORT');
                
                const longPnL = longTrades.reduce((sum, t) => sum + t.pnl, 0);
                const shortPnL = shortTrades.reduce((sum, t) => sum + t.pnl, 0);
                
                const longWins = longTrades.filter(t => t.pnl > 0).length;
                const shortWins = shortTrades.filter(t => t.pnl > 0).length;
                
                const longWR = longTrades.length > 0 ? (longWins / longTrades.length * 100).toFixed(0) : 0;
                const shortWR = shortTrades.length > 0 ? (shortWins / shortTrades.length * 100).toFixed(0) : 0;

                document.getElementById('globalLongPnL').textContent = this.formatCurrency(longPnL);
                document.getElementById('globalLongPnL').style.color = longPnL >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
                document.getElementById('globalLongInfo').textContent = `${longTrades.length} trades | ${longWR}% WR`;

                document.getElementById('globalShortPnL').textContent = this.formatCurrency(shortPnL);
                document.getElementById('globalShortPnL').style.color = shortPnL >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
                document.getElementById('globalShortInfo').textContent = `${shortTrades.length} trades | ${shortWR}% WR`;

                // Global strategy adherence
                const tradesWithStrategy = allTrades.filter(t => t.followedStrategy);
                const adherence = allTrades.length > 0 ? (tradesWithStrategy.length / allTrades.length * 100).toFixed(1) : 0;

                document.getElementById('globalStrategyPercent').textContent = `${adherence}%`;
                document.getElementById('globalStrategyPercent').style.color = adherence >= 70 ? 'var(--accent-green)' : 'var(--accent-red)';
                document.getElementById('globalStrategyDetails').textContent = `${tradesWithStrategy.length} / ${allTrades.length} trades`;

                const withStrategyPnL = tradesWithStrategy.reduce((sum, t) => sum + t.pnl, 0);
                const withStrategyWins = tradesWithStrategy.filter(t => t.pnl > 0).length;
                const withStrategyWR = tradesWithStrategy.length > 0 ? (withStrategyWins / tradesWithStrategy.length * 100).toFixed(0) : 0;

                const withoutStrategy = allTrades.filter(t => !t.followedStrategy);
                const withoutStrategyPnL = withoutStrategy.reduce((sum, t) => sum + t.pnl, 0);
                const withoutStrategyWins = withoutStrategy.filter(t => t.pnl > 0).length;
                const withoutStrategyWR = withoutStrategy.length > 0 ? (withoutStrategyWins / withoutStrategy.length * 100).toFixed(0) : 0;

                document.getElementById('globalWithStrategy').innerHTML = `
                    <span style="color: ${withStrategyPnL >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}; font-size: 1.25rem; font-family: 'Manrope', sans-serif;">
                        ${this.formatCurrency(withStrategyPnL)}
                    </span> ‚Ä¢ ${withStrategyWR}% WR
                `;

                document.getElementById('globalWithoutStrategy').innerHTML = `
                    <span style="color: ${withoutStrategyPnL >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}; font-size: 1.25rem; font-family: 'Manrope', sans-serif;">
                        ${this.formatCurrency(withoutStrategyPnL)}
                    </span> ‚Ä¢ ${withoutStrategyWR}% WR
                `;

                // Global best instruments
                const instrumentPnL = {};
                allTrades.forEach(trade => {
                    if (!instrumentPnL[trade.instrument]) {
                        instrumentPnL[trade.instrument] = 0;
                    }
                    instrumentPnL[trade.instrument] += trade.pnl;
                });

                const sortedInstruments = Object.entries(instrumentPnL)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5);

                document.getElementById('globalBestInstruments').innerHTML = sortedInstruments.length > 0 
                    ? sortedInstruments.map(([instrument, pnl]) => `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: var(--bg-secondary); border-radius: 8px;">
                            <span style="font-weight: 600;">${instrument}</span>
                            <span style="font-family: 'Manrope', sans-serif; font-weight: 700; font-size: 1.1rem; color: ${pnl >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}">
                                ${pnl >= 0 ? '+' : ''}${pnl.toFixed(0)}‚Ç¨
                            </span>
                        </div>
                    `).join('')
                    : '<div style="color: var(--text-secondary); text-align: center;">Pas encore de donn√©es</div>';

                // Accounts comparison
                const accountsComparison = this.accounts.map(acc => {
                    const accTrades = this.trades.filter(t => t.accountId === acc.id);
                    const accPnL = accTrades.reduce((s, t) => s + t.pnl, 0);
                    const accWins = accTrades.filter(t => t.pnl > 0).length;
                    const accWR = accTrades.length > 0 ? (accWins / accTrades.length * 100).toFixed(1) : 0;
                    const accCapital = acc.baseCapital + accPnL;
                    
                    return { acc, accPnL, accTrades, accWins, accWR, accCapital };
                }).sort((a, b) => b.accPnL - a.accPnL);

                document.getElementById('accountsComparison').innerHTML = accountsComparison.map(({acc, accPnL, accTrades, accWins, accWR, accCapital}) => `
                    <div style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 1.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <div>
                                <h3 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 0.25rem;">${acc.name}</h3>
                                <p style="font-size: 0.9rem; color: var(--text-secondary);">üè¢ ${acc.propFirm}</p>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 1.75rem; font-weight: 700; font-family: 'Manrope', sans-serif; color: ${accPnL >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}">
                                    ${accPnL >= 0 ? '+' : ''}${this.formatCurrency(accPnL)}
                                </div>
                                <div style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 0.25rem;">
                                    ${this.formatCurrency(accCapital)}
                                </div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 2rem; font-size: 0.95rem;">
                            <div>
                                <span style="color: var(--text-secondary);">Trades:</span>
                                <span style="font-weight: 700; margin-left: 0.5rem;">${accTrades.length}</span>
                            </div>
                            <div>
                                <span style="color: var(--text-secondary);">Win Rate:</span>
                                <span style="font-weight: 700; margin-left: 0.5rem; color: ${accWR >= 50 ? 'var(--accent-green)' : 'var(--accent-red)'}">
                                    ${accWR}%
                                </span>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            // Theme Management
            toggleTheme() {
                this.currentTheme = this.currentTheme === 'dark' ? 'light' : 'dark';
                localStorage.setItem('theme', this.currentTheme);
                this.applyTheme();
            }

            applyTheme() {
                document.documentElement.setAttribute('data-theme', this.currentTheme);
                const icon = document.getElementById('themeIcon');
                if (icon) {
                    icon.textContent = this.currentTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
                }
            }

            // Google Drive Integration
            async initGoogleDrive() {
                const savedToken = localStorage.getItem('google_access_token');
                const savedUser = localStorage.getItem('google_user');
                
                if (savedToken && savedUser) {
                    this.accessToken = savedToken;
                    this.googleUser = JSON.parse(savedUser);
                    this.updateGoogleUI(true);
                    await this.loadFromDrive();
                }
            }

            async signInWithGoogle() {
                try {
                    const GOOGLE_CLIENT_ID = '5328933201-hhed8j3flifhdf4229sfof4247hugd1h.apps.googleusercontent.com';
                    const GOOGLE_DRIVE_SCOPE = 'https://www.googleapis.com/auth/drive.file';

                    const client = google.accounts.oauth2.initTokenClient({
                        client_id: GOOGLE_CLIENT_ID,
                        scope: GOOGLE_DRIVE_SCOPE,
                        callback: async (response) => {
                            if (response.access_token) {
                                this.accessToken = response.access_token;
                                localStorage.setItem('google_access_token', response.access_token);
                                
                                const userInfo = await this.getUserInfo(response.access_token);
                                this.googleUser = userInfo;
                                localStorage.setItem('google_user', JSON.stringify(userInfo));
                                
                                this.updateGoogleUI(true);
                                await this.loadFromDrive();
                                alert('‚úÖ Connect√© √† Google Drive ! Vos donn√©es sont synchronis√©es.');
                            }
                        },
                    });
                    client.requestAccessToken();
                } catch (error) {
                    console.error('Erreur connexion Google:', error);
                    alert('‚ùå Erreur de connexion Google');
                }
            }

            signOutFromTop() {
                if (confirm('Se d√©connecter de Google Drive ? Vos donn√©es locales seront conserv√©es.')) {
                    localStorage.removeItem('google_access_token');
                    localStorage.removeItem('google_user');
                    this.accessToken = null;
                    this.googleUser = null;
                    this.driveFileId = null;
                    this.updateGoogleUI(false);
                    alert('üëã D√©connect√© de Google Drive');
                }
            }

            updateGoogleUI(signedIn) {
                const signInBtn = document.getElementById('googleSignInBtn');
                const userBadge = document.getElementById('googleUserBadge');

                if (signedIn && this.googleUser) {
                    // Desktop: show badge, hide button
                    if (window.innerWidth > 768) {
                        signInBtn.style.display = 'none';
                        userBadge.style.display = 'flex';
                        userBadge.style.removeProperty('display');
                    } else {
                        // Mobile: show button with green dot
                        signInBtn.classList.add('connected');
                        signInBtn.style.display = 'flex';
                        signInBtn.style.position = 'relative';
                        userBadge.style.display = 'none';
                    }
                    
                    document.getElementById('googleUserNameTop').textContent = this.googleUser.name;
                    document.getElementById('googleUserAvatarTop').src = this.googleUser.picture;
                } else {
                    signInBtn.classList.remove('connected');
                    signInBtn.style.display = 'flex';
                    signInBtn.style.removeProperty('position');
                    userBadge.style.display = 'none';
                }
            }

            async getUserInfo(accessToken) {
                const response = await fetch('https://www.googleapis.com/oauth2/v2/userinfo', {
                    headers: { Authorization: `Bearer ${accessToken}` }
                });
                return await response.json();
            }

            async saveToDrive() {
                if (!this.accessToken) return;

                try {
                    const data = {
                        settings: this.settings,
                        accounts: this.accounts,
                        currentAccountId: this.currentAccountId,
                        trades: this.trades,
                        lastSync: new Date().toISOString()
                    };

                    const content = JSON.stringify(data, null, 2);
                    const file = new Blob([content], { type: 'application/json' });

                    if (!this.driveFileId) {
                        const searchResponse = await fetch(
                            `https://www.googleapis.com/drive/v3/files?q=name='tradescope-data.json'+and+trashed=false&fields=files(id,name)`,
                            { headers: { Authorization: `Bearer ${this.accessToken}` }}
                        );
                        const searchResult = await searchResponse.json();
                        if (searchResult.files && searchResult.files.length > 0) {
                            this.driveFileId = searchResult.files[0].id;
                        }
                    }

                    const metadata = { name: 'tradescope-data.json', mimeType: 'application/json' };
                    const form = new FormData();
                    form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
                    form.append('file', file);

                    const url = this.driveFileId
                        ? `https://www.googleapis.com/upload/drive/v3/files/${this.driveFileId}?uploadType=multipart`
                        : 'https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart';

                    const response = await fetch(url, {
                        method: this.driveFileId ? 'PATCH' : 'POST',
                        headers: { Authorization: `Bearer ${this.accessToken}` },
                        body: form
                    });

                    const result = await response.json();
                    this.driveFileId = result.id;
                } catch (error) {
                    console.error('Erreur sauvegarde Drive:', error);
                }
            }

            async loadFromDrive() {
                if (!this.accessToken) return;

                try {
                    const searchResponse = await fetch(
                        `https://www.googleapis.com/drive/v3/files?q=name='tradescope-data.json'+and+trashed=false&fields=files(id,name)`,
                        { headers: { Authorization: `Bearer ${this.accessToken}` }}
                    );
                    const searchResult = await searchResponse.json();

                    if (!searchResult.files || searchResult.files.length === 0) return;

                    this.driveFileId = searchResult.files[0].id;

                    const fileResponse = await fetch(
                        `https://www.googleapis.com/drive/v3/files/${this.driveFileId}?alt=media`,
                        { headers: { Authorization: `Bearer ${this.accessToken}` }}
                    );
                    const data = await fileResponse.json();

                    if (data.settings) this.settings = data.settings;
                    if (data.accounts) this.accounts = data.accounts;
                    if (data.currentAccountId) this.currentAccountId = data.currentAccountId;
                    if (data.trades) this.trades = data.trades;

                    this.saveSettings();
                    this.saveAccounts();
                    this.saveCurrentAccountId();
                    this.saveTrades();

                    this.updateAllDisplays();
                } catch (error) {
                    console.error('Erreur chargement Drive:', error);
                }
            }

            updatePayoutsView() {
                const accountPayouts = this.getAccountPayouts();
                const allPayouts = this.getAllPayouts();

                // Account totals
                const accountTotal = accountPayouts.reduce((sum, p) => sum + Math.abs(p.pnl), 0);
                const globalTotal = allPayouts.reduce((sum, p) => sum + Math.abs(p.pnl), 0);

                document.getElementById('payoutAccountTotal').textContent = this.formatCurrency(accountTotal);
                document.getElementById('payoutAccountCount').innerHTML = `
                    <span>‚óè</span>
                    <span>${accountPayouts.length} payout${accountPayouts.length > 1 ? 's' : ''}</span>
                `;

                document.getElementById('payoutGlobalTotal').textContent = this.formatCurrency(globalTotal);
                document.getElementById('payoutGlobalCount').innerHTML = `
                    <span>‚óè</span>
                    <span>${allPayouts.length} payout${allPayouts.length > 1 ? 's' : ''}</span>
                `;

                // Last payout
                if (accountPayouts.length > 0) {
                    const lastPayout = accountPayouts[0];
                    document.getElementById('payoutLast').textContent = this.formatCurrency(Math.abs(lastPayout.pnl));
                    document.getElementById('payoutLastDate').innerHTML = `
                        <span>‚óã</span>
                        <span>${new Date(lastPayout.date).toLocaleDateString('fr-FR')}</span>
                    `;
                } else {
                    document.getElementById('payoutLast').textContent = '-';
                    document.getElementById('payoutLastDate').innerHTML = `<span>‚óã</span><span>-</span>`;
                }

                // Average
                const average = accountPayouts.length > 0 ? accountTotal / accountPayouts.length : 0;
                document.getElementById('payoutAverage').textContent = this.formatCurrency(average);

                // Render table
                this.renderPayoutsTable();
            }

            renderPayoutsTable() {
                const tbody = document.getElementById('payoutsTableBody');
                const accountPayouts = this.getAccountPayouts();

                if (accountPayouts.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" class="empty-state">
                                <div class="empty-icon">üí∞</div>
                                <div>Aucun payout enregistr√©</div>
                            </td>
                        </tr>
                    `;
                    
                    const cardsContainer = document.getElementById('payoutsCardsContainer');
                    if (cardsContainer) {
                        cardsContainer.innerHTML = `
                            <div class="empty-state" style="display: flex; flex-direction: column; align-items: center; padding: 2rem; color: var(--text-secondary);">
                                <div class="empty-icon">üí∞</div>
                                <div>Aucun payout enregistr√©</div>
                            </div>
                        `;
                    }
                    return;
                }

                const accountsMap = {};
                this.accounts.forEach(acc => accountsMap[acc.id] = acc.name);

                // Table rows for desktop
                tbody.innerHTML = accountPayouts.map(payout => {
                    const amount = Math.abs(payout.pnl);
                    const capitalBefore = this.getCurrentCapital() + amount;
                    const capitalAfter = this.getCurrentCapital();

                    return `
                        <tr>
                            <td>${new Date(payout.date).toLocaleDateString('fr-FR')}</td>
                            <td style="font-weight: 600;">${accountsMap[payout.accountId] || 'Compte'}</td>
                            <td class="pnl-value negative" style="font-size: 1.1rem;">-${this.formatCurrency(amount)}</td>
                            <td>${this.formatCurrency(capitalBefore)}</td>
                            <td>${this.formatCurrency(capitalAfter)}</td>
                            <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis;">${payout.notes || '-'}</td>
                            <td>
                                <button onclick="journal.deleteTrade(${payout.id})" style="background: var(--accent-red); color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">√ó</button>
                            </td>
                        </tr>
                    `;
                }).join('');

                // Mobile cards
                const cardsContainer = document.getElementById('payoutsCardsContainer');
                if (cardsContainer) {
                    cardsContainer.innerHTML = accountPayouts.map(payout => {
                        const amount = Math.abs(payout.pnl);
                        
                        return `
                            <div class="trade-card">
                                <div class="trade-card-header">
                                    <div>
                                        <div style="font-weight: 700; font-size: 1.1rem; margin-bottom: 0.25rem;">
                                            ${accountsMap[payout.accountId] || 'Compte'}
                                        </div>
                                        <div style="font-size: 0.85rem; color: var(--text-secondary);">
                                            ${new Date(payout.date).toLocaleDateString('fr-FR')}
                                        </div>
                                    </div>
                                    <div class="pnl-value negative" style="font-size: 1.3rem; font-weight: 700;">
                                        -${this.formatCurrency(amount)}
                                    </div>
                                </div>
                                <div class="trade-card-body">
                                    <div class="trade-card-field" style="grid-column: span 2;">
                                        <div class="trade-card-label">Notes</div>
                                        <div class="trade-card-value">${payout.notes || '-'}</div>
                                    </div>
                                </div>
                                <div class="trade-card-actions">
                                    <button onclick="journal.deleteTrade(${payout.id})" class="btn" style="background: var(--accent-red); flex: 1; padding: 0.5rem 1rem; font-size: 0.85rem;">Supprimer</button>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
            }

            // Playbook Management
            loadPlaybookRules() {
                const saved = localStorage.getItem('playbookRules');
                if (saved) return JSON.parse(saved);
                
                // Default rules
                return [
                    { id: 1, text: "V√©rifier la tendance g√©n√©rale (H4/D1)" },
                    { id: 2, text: "Identifier un setup valide" },
                    { id: 3, text: "Risk/Reward minimum 2:1" },
                    { id: 4, text: "Respecter mon risk management (1-2%)" },
                    { id: 5, text: "V√©rifier les news √©conomiques" },
                    { id: 6, text: "√ätre dans les bonnes conditions mentales" }
                ];
            }

            savePlaybookRules() {
                localStorage.setItem('playbookRules', JSON.stringify(this.playbookRules));
                this.saveToDrive();
            }

            loadDailyChecklist() {
                const saved = localStorage.getItem('dailyChecklist');
                const savedDate = localStorage.getItem('dailyChecklistDate');
                const today = new Date().toDateString();
                
                // Reset if it's a new day
                if (savedDate !== today) {
                    localStorage.setItem('dailyChecklistDate', today);
                    return {};
                }
                
                return saved ? JSON.parse(saved) : {};
            }

            saveDailyChecklist() {
                localStorage.setItem('dailyChecklist', JSON.stringify(this.dailyChecklist));
            }

            renderPlaybookView() {
                // Render rules list
                const rulesList = document.getElementById('playbookRulesList');
                if (this.playbookRules.length === 0) {
                    rulesList.innerHTML = `
                        <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                            Aucune r√®gle d√©finie. Clique sur "+ Ajouter" pour cr√©er ta premi√®re r√®gle.
                        </div>
                    `;
                } else {
                    rulesList.innerHTML = this.playbookRules.map(rule => `
                        <div style="display: flex; align-items: center; justify-content: space-between; padding: 1rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px;">
                            <div style="flex: 1;">
                                <span style="font-weight: 500;">${rule.text}</span>
                            </div>
                            <button onclick="journal.deletePlaybookRule(${rule.id})" style="background: transparent; border: 1px solid var(--accent-red); color: var(--accent-red); padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.85rem;">
                                √ó
                            </button>
                        </div>
                    `).join('');
                }

                // Render daily checklist
                this.renderDailyChecklist();

                // Update stats
                this.updatePlaybookStats();
            }

            renderDailyChecklist() {
                const container = document.getElementById('dailyChecklistContainer');
                if (this.playbookRules.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                            Ajoute des r√®gles dans ton playbook pour activer la checklist.
                        </div>
                    `;
                    return;
                }

                const checkedCount = Object.values(this.dailyChecklist).filter(v => v).length;
                const progress = (checkedCount / this.playbookRules.length * 100).toFixed(0);

                container.innerHTML = `
                    <div style="margin-bottom: 1.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span style="color: var(--text-secondary); font-size: 0.9rem;">Progression</span>
                            <span style="font-weight: 700; color: var(--accent-primary);">${checkedCount} / ${this.playbookRules.length}</span>
                        </div>
                        <div style="height: 12px; background: var(--bg-secondary); border-radius: 6px; overflow: hidden;">
                            <div style="height: 100%; background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary)); width: ${progress}%; transition: width 0.3s ease;"></div>
                        </div>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                        ${this.playbookRules.map(rule => {
                            const isChecked = this.dailyChecklist[rule.id] || false;
                            return `
                                <label style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: ${isChecked ? 'rgba(16, 185, 129, 0.1)' : 'var(--bg-secondary)'}; border: 1px solid ${isChecked ? 'var(--accent-green)' : 'var(--border)'}; border-radius: 8px; cursor: pointer; transition: all 0.2s ease;">
                                    <input type="checkbox" ${isChecked ? 'checked' : ''} onchange="journal.toggleDailyChecklistItem(${rule.id})" style="width: 20px; height: 20px; cursor: pointer;">
                                    <span style="flex: 1; font-weight: ${isChecked ? '600' : '400'}; color: ${isChecked ? 'var(--accent-green)' : 'var(--text-primary)'};">
                                        ${rule.text}
                                    </span>
                                    ${isChecked ? '<span style="color: var(--accent-green);">‚úì</span>' : ''}
                                </label>
                            `;
                        }).join('')}
                    </div>
                `;
            }

            toggleDailyChecklistItem(ruleId) {
                this.dailyChecklist[ruleId] = !this.dailyChecklist[ruleId];
                this.saveDailyChecklist();
                this.renderDailyChecklist();
                this.updatePlaybookStats();
            }

            resetDailyChecklist() {
                if (confirm('R√©initialiser la checklist du jour ?')) {
                    this.dailyChecklist = {};
                    this.saveDailyChecklist();
                    this.renderDailyChecklist();
                    this.updatePlaybookStats();
                }
            }

            updatePlaybookStats() {
                const allTrades = this.getAccountTrades();
                const today = new Date().toDateString();
                const todayTrades = allTrades.filter(t => new Date(t.date).toDateString() === today);

                // Today stats
                const todayWithStrategy = todayTrades.filter(t => t.followedStrategy).length;
                const todayPercent = todayTrades.length > 0 ? (todayWithStrategy / todayTrades.length * 100).toFixed(0) : 0;
                document.getElementById('playbookTodayPercent').textContent = `${todayPercent}%`;
                document.getElementById('playbookTodayCount').innerHTML = `
                    <span>‚óè</span>
                    <span>${todayWithStrategy} / ${todayTrades.length} trades</span>
                `;

                // Global stats
                const withStrategy = allTrades.filter(t => t.followedStrategy).length;
                const globalPercent = allTrades.length > 0 ? (withStrategy / allTrades.length * 100).toFixed(0) : 0;
                document.getElementById('playbookGlobalPercent').textContent = `${globalPercent}%`;
                document.getElementById('playbookGlobalCount').innerHTML = `
                    <span>‚óè</span>
                    <span>${withStrategy} / ${allTrades.length} trades</span>
                `;

                // Win rate when following strategy
                const strategyTrades = allTrades.filter(t => t.followedStrategy);
                const strategyWins = strategyTrades.filter(t => t.pnl > 0).length;
                const winRate = strategyTrades.length > 0 ? (strategyWins / strategyTrades.length * 100).toFixed(0) : 0;
                document.getElementById('playbookWinRate').textContent = `${winRate}%`;
            }

            openAddRuleModal() {
                document.getElementById('addRuleModal').classList.add('active');
            }

            closeAddRuleModal() {
                document.getElementById('addRuleModal').classList.remove('active');
                document.getElementById('addRuleForm').reset();
            }

            addPlaybookRule(e) {
                e.preventDefault();
                const text = document.getElementById('ruleText').value.trim();
                if (!text) return;

                const newRule = {
                    id: Date.now(),
                    text: text
                };

                this.playbookRules.push(newRule);
                this.savePlaybookRules();
                this.closeAddRuleModal();
                this.renderPlaybookView();
            }

            deletePlaybookRule(id) {
                if (confirm('Supprimer cette r√®gle ?')) {
                    this.playbookRules = this.playbookRules.filter(r => r.id !== id);
                    delete this.dailyChecklist[id];
                    this.savePlaybookRules();
                    this.saveDailyChecklist();
                    this.renderPlaybookView();
                }
            }

            formatCurrency(value) {
                return new Intl.NumberFormat('fr-FR', {
                    style: 'currency',
                    currency: 'EUR',
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                }).format(value);
            }
        }

        const journal = new TradingJournal();
    </script>
</body>
</html>